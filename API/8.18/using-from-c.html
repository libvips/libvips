<!--
SPDX-FileCopyrightText: libvips team and contributors

SPDX-License-Identifier: LGPL-2.1-or-later
-->

<!DOCTYPE html>
<html lang="en">
<head>
  <title>Vips &ndash; 8.0: Using &gt; C</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta charset="utf-8" />

  
  <meta property="og:type" content="website"/>

  

  
  <meta property="og:title" content="Vips: Using &gt; C"/>
  <meta property="og:description" content="Reference for Vips-8.0: Using &gt; C"/>
  <meta name="twitter:title" content="Vips: Using &gt; C"/>
  <meta name="twitter:description" content="Reference for Vips-8.0: Using &gt; C"/>


  
  <meta name="twitter:card" content="summary"/>

  
  
  
  <link rel="search" type="application/opensearchdescription+xml" title="Vips" href="opensearch.xml">
  
  

  <link rel="stylesheet" href="style.css" type="text/css" />

  

  
  <script src="urlmap.js"></script>
  
  
  <script src="fzy.js"></script>
  <script src="search.js"></script>
  
  <script src="main.js"></script>

  
</head>

<body>
  <div id="body-wrapper" tabindex="-1">

    <nav class="sidebar devhelp-hidden">
      
      
      <div class="search section">
        <form id="search-form" autocomplete="off">
          <input id="search-input" type="text" name="do-not-autocomplete" placeholder="Click, or press 's' to search" autocomplete="off"/>
        </form>
      </div>
      
      <div class="section namespace">
        <h3><a href="index.html">Vips</a></h3>
        <p>API Version: 8.0</p>
        
        <p>Library Version: 8.18</p>
        
      </div>
      
      
      <div class="section generator">
        <p>Generated by <a href="https://gitlab.gnome.org/GNOME/gi-docgen">gi-docgen</a> 2025.3</p>
      </div>
    </nav>

    <button id="btn-to-top" class="hidden"><span class="up-arrow"></span></button>

    
<section id="main" class="content">
  
  <h4 id="title" style="display:flex;">
    Using &gt; C
    <a href="#title" class="anchor"></a>
    
    <a class="srclink" title="go to source location" href="https://github.com/libvips/libvips/blob/master/doc/using-from-c.md">[src]</a>
    
  </h4>
  
  <section>
    <div class="docblock">
    <p>libvips comes with a convenient, high-level C <span class="caps">API</span>. You should read the <span class="caps">API</span>
docs for full details, but this section will try to give a brief&nbsp;overview.</p>
<h2 id="library-startup">Library startup<a class="md-anchor" href="#library-startup" title="Permanent link"></a></h2>
<p>When your program starts, use <a href="func.INIT.html"><code>VIPS_INIT()</code></a> to start up libvips. You
should pass it the name of your program, usually <code>argv[0]</code>. If
you call <a href="func.shutdown.html"><code>vips_shutdown()</code></a> just before you exit, libvips will attempt to free
all resources. This can help leak checking, but is not&nbsp;required.</p>
<p><a href="func.INIT.html"><code>VIPS_INIT()</code></a> is a macro to let it check that the libvips shared library you
have linked to matches the libvips headers you&nbsp;included.</p>
<p>You can add the libvips flags to your <a href="javascript:void(0)" data-namespace="GObject" data-link="class.Object.html" class="external"><code>GObject</code></a> command-line
processing with <a href="func.add_option_entries.html"><code>vips_add_option_entries()</code></a>.</p>
<h2 id="the-vipsimage-class">The <a href="class.Image.html"><code>VipsImage</code></a> class<a class="md-anchor" href="#the-vipsimage-class" title="Permanent link"></a></h2>
<p>The basic data object is the <a href="class.Image.html"><code>VipsImage</code></a>. You can create an image from a
file on disc or from an area of memory, either as a C-style array, or as a
formatted object, like <span class="caps">JPEG</span>. See <a href="ctor.Image.new_from_file.html"><code>vips_image_new_from_file()</code></a> and friends.
Loading an image is fast: libvips read just enough of the image to be able
to get the various properties, such as width, but no decoding occurs until
pixel values are really&nbsp;needed.</p>
<p>Once you have an image, you can get properties from it in the usual
way. You can use projection functions, like <a href="method.Image.get_width.html"><code>vips_image_get_width()</code></a> or
<a href="javascript:void(0)" data-namespace="GObject" data-link="method.Object.get.html" class="external"><code>g_object_get()</code></a>, to get <a href="javascript:void(0)" data-namespace="GObject" data-link="class.Object.html" class="external"><code>GObject</code></a> properties. All
libvips objects are immutable, meaning you can only get properties, you
can&#8217;t set them. See <a href="file-format.html">libvips Header</a> to read about image&nbsp;properties.</p>
<h2 id="reference-counting">Reference counting<a class="md-anchor" href="#reference-counting" title="Permanent link"></a></h2>
<p>libvips is based on the <a href="javascript:void(0)" data-namespace="GObject" data-link="class.Object.html" class="external"><code>GObject</code></a> library and is therefore
reference counted. <a href="ctor.Image.new_from_file.html"><code>vips_image_new_from_file()</code></a> returns an object with a count
of 1. When you are done with an image, use <a href="javascript:void(0)" data-namespace="GObject" data-link="method.Object.unref.html" class="external"><code>g_object_unref()</code></a> to
dispose of it. If you pass an image to an operation and that operation needs
to keep a copy of the image, it will ref it. So you can unref an image as soon
as you no longer need it, you don&#8217;t need to hang on to it in case anyone else
is still using&nbsp;it.</p>
<p>See <a href="class.Operation.html"><code>VipsOperation</code></a> for more details on libvips&#8217; reference counting
conventions. See the <a href="#reference-pools">Reference pools</a> section below
for a way to automate reference counting in&nbsp;C.</p>
<h2 id="libvips-operations">libvips operations<a class="md-anchor" href="#libvips-operations" title="Permanent link"></a></h2>
<p>Use things like <a href="method.Image.embed.html"><code>vips_embed()</code></a> to manipulate your images. You use it
from C like&nbsp;this:</p>
<div class="codehilite"><pre><span></span><code><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">filename</span><span class="p">;</span>
<span class="n">VipsImage</span><span class="w"> </span><span class="o">*</span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vips_image_new_from_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span>
<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span>
<span class="n">VipsImage</span><span class="w"> </span><span class="o">*</span><span class="n">out</span><span class="p">;</span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">vips_embed</span><span class="p">(</span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">))</span>
<span class="w">    </span><span class="n">error_handling</span><span class="p">();</span>
</code></pre></div>

<p>Now <code>out</code> will hold a reference to a 1000 by 1000 pixel image, with <code>in</code>
pasted 10 right and 10 down from the top left-hand corner. The remainder
of the image will be black. If <code>in</code> is too large, it will be clipped at
the image&nbsp;edges.</p>
<p>Operations can take optional arguments. You give these as a set of
<span class="caps">NULL</span>-terminated name-value pairs at the end of the call. For example,
you can&nbsp;write:</p>
<div class="codehilite"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">vips_embed</span><span class="p">(</span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="p">,</span>
<span class="w">               </span><span class="s">&quot;extend&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">VIPS_EXTEND_COPY</span><span class="p">,</span>
<span class="w">               </span><span class="nb">NULL</span><span class="p">))</span>
<span class="w">    </span><span class="n">error_handling</span><span class="p">();</span>
</code></pre></div>

<p>And now the new edge pixels, which were black, will be filled with a copy
of the edge pixels of <code>in</code>. Operation options are listed at the top of each
operation&#8217;s entry in the docs. Alternatively, the <code>vips</code> program is handy
for getting a summary of an operation&#8217;s parameters. For&nbsp;example:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>vips<span class="w"> </span>embed
embed<span class="w"> </span>an<span class="w"> </span>image<span class="w"> </span><span class="k">in</span><span class="w"> </span>a<span class="w"> </span>larger<span class="w"> </span>image
usage:
<span class="w">   </span>embed<span class="w"> </span><span class="k">in</span><span class="w"> </span>out<span class="w"> </span>x<span class="w"> </span>y<span class="w"> </span>width<span class="w"> </span>height<span class="w"> </span><span class="o">[</span>--option-name<span class="w"> </span>option-value<span class="w"> </span>...<span class="o">]</span>
where:
<span class="w">   </span><span class="k">in</span><span class="w">           </span>-<span class="w"> </span>Input<span class="w"> </span>image,<span class="w"> </span>input<span class="w"> </span>VipsImage
<span class="w">   </span>out<span class="w">          </span>-<span class="w"> </span>Output<span class="w"> </span>image,<span class="w"> </span>output<span class="w"> </span>VipsImage
<span class="w">   </span>x<span class="w">            </span>-<span class="w"> </span>Left<span class="w"> </span>edge<span class="w"> </span>of<span class="w"> </span>input<span class="w"> </span><span class="k">in</span><span class="w"> </span>output,<span class="w"> </span>input<span class="w"> </span>gint
<span class="w">                      </span>default:<span class="w"> </span><span class="m">0</span>
<span class="w">                      </span>min:<span class="w"> </span>-1000000000,<span class="w"> </span>max:<span class="w"> </span><span class="m">1000000000</span>
<span class="w">   </span>y<span class="w">            </span>-<span class="w"> </span>Top<span class="w"> </span>edge<span class="w"> </span>of<span class="w"> </span>input<span class="w"> </span><span class="k">in</span><span class="w"> </span>output,<span class="w"> </span>input<span class="w"> </span>gint
<span class="w">                      </span>default:<span class="w"> </span><span class="m">0</span>
<span class="w">                      </span>min:<span class="w"> </span>-1000000000,<span class="w"> </span>max:<span class="w"> </span><span class="m">1000000000</span>
<span class="w">   </span>width<span class="w">        </span>-<span class="w"> </span>Image<span class="w"> </span>width<span class="w"> </span><span class="k">in</span><span class="w"> </span>pixels,<span class="w"> </span>input<span class="w"> </span>gint
<span class="w">                      </span>default:<span class="w"> </span><span class="m">1</span>
<span class="w">                      </span>min:<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>max:<span class="w"> </span><span class="m">1000000000</span>
<span class="w">   </span>height<span class="w">       </span>-<span class="w"> </span>Image<span class="w"> </span>height<span class="w"> </span><span class="k">in</span><span class="w"> </span>pixels,<span class="w"> </span>input<span class="w"> </span>gint
<span class="w">                      </span>default:<span class="w"> </span><span class="m">1</span>
<span class="w">                      </span>min:<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>max:<span class="w"> </span><span class="m">1000000000</span>
optional<span class="w"> </span>arguments:
<span class="w">   </span>extend<span class="w">       </span>-<span class="w"> </span>How<span class="w"> </span>to<span class="w"> </span>generate<span class="w"> </span>the<span class="w"> </span>extra<span class="w"> </span>pixels,<span class="w"> </span>input<span class="w"> </span>VipsExtend
<span class="w">                      </span>default<span class="w"> </span>enum:<span class="w"> </span>black
<span class="w">                      </span>allowed<span class="w"> </span>enums:<span class="w"> </span>black,<span class="w"> </span>copy,<span class="w"> </span>repeat,<span class="w"> </span>mirror,<span class="w"> </span>white,<span class="w"> </span>background
<span class="w">   </span>background<span class="w">   </span>-<span class="w"> </span>Colour<span class="w"> </span><span class="k">for</span><span class="w"> </span>background<span class="w"> </span>pixels,<span class="w"> </span>input<span class="w"> </span>VipsArrayDouble
</code></pre></div>

<p>See <a href="class.Operation.html"><code>VipsOperation</code></a> for more information on running operations on&nbsp;images.</p>
<p>The <span class="caps">API</span> docs have a <a href="function-list.html">handy table of all libvips operations</a>, if you want to find out how to do something, try
searching&nbsp;that.</p>
<p>When you are done, you can write the final image to a disc file,
to a formatted memory buffer, or to C-style memory array. See
<a href="method.Image.write_to_file.html"><code>vips_image_write_to_file()</code></a> and&nbsp;friends.</p>
<h2 id="getting-pixels">Getting pixels<a class="md-anchor" href="#getting-pixels" title="Permanent link"></a></h2>
<p>Use <a href="class.Region.html"><code>VipsRegion</code></a> to read pixels out of images. You can use <a href="func.IMAGE_ADDR.html"><code>VIPS_IMAGE_ADDR()</code></a>
as well, but this can need a large amount of memory to work. See <a href="extending.html">extending</a> for an introduction to writing your own&nbsp;operations.</p>
<h2 id="error-handling">Error handling<a class="md-anchor" href="#error-handling" title="Permanent link"></a></h2>
<p>libvips keeps a log of error message, see <a href="func.error_buffer.html"><code>vips_error_buffer()</code></a> and
<a href="func.error_clear.html"><code>vips_error_clear()</code></a> to find out how to get and clear the error&nbsp;log.</p>
<h2 id="example">Example<a class="md-anchor" href="#example" title="Permanent link"></a></h2>
<p>On Unix systems, you can compile the <a href="#libvips-from-c-example">example code</a>
with something&nbsp;like:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>gcc<span class="w"> </span>-g<span class="w"> </span>-Wall<span class="w"> </span>myprog.c<span class="w"> </span><span class="sb">`</span>pkg-config<span class="w"> </span>vips<span class="w"> </span>--cflags<span class="w"> </span>--libs<span class="sb">`</span>
</code></pre></div>

<p>On Windows, you&#8217;ll need to set the compiler flags by hand,&nbsp;perhaps:</p>
<div class="codehilite"><pre><span></span><code>x86_64-w64-mingw32-gcc-win32<span class="w"> </span>-mms-bitfields<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-Ic:/vips-8.6/include<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-Ic:/vips-8.6/include/glib-2.0<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-Ic:/vips-8.6/lib/glib-2.0/include<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>myprog.c<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-Lc:/vips-8.6/lib<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-lvips<span class="w"> </span>-lz<span class="w"> </span>-ljpeg<span class="w"> </span>-lstdc++<span class="w"> </span>-lxml2<span class="w"> </span>-lfftw3<span class="w"> </span>-lm<span class="w"> </span>-lMagickWand<span class="w"> </span>-llcms2<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-lopenslide<span class="w"> </span>-lcfitsio<span class="w"> </span>-lpangoft2-1.0<span class="w"> </span>-ltiff<span class="w"> </span>-lpng14<span class="w"> </span>-lexif<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-lMagickCore<span class="w"> </span>-lpango-1.0<span class="w"> </span>-lfreetype<span class="w"> </span>-lfontconfig<span class="w"> </span>-lgobject-2.0<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-lgmodule-2.0<span class="w"> </span>-lgthread-2.0<span class="w"> </span>-lglib-2.0<span class="w"> </span>-lintl<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-o<span class="w"> </span>myprog.exe
</code></pre></div>

<h2 id="libvips-from-c-example">libvips from C example<a class="md-anchor" href="#libvips-from-c-example" title="Permanent link"></a></h2>
<div class="codehilite"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vips/vips.h&gt;</span>

<span class="kt">int</span>
<span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">VipsImage</span><span class="w"> </span><span class="o">*</span><span class="n">in</span><span class="p">;</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">mean</span><span class="p">;</span>
<span class="w">    </span><span class="n">VipsImage</span><span class="w"> </span><span class="o">*</span><span class="n">out</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">VIPS_INIT</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="w">        </span><span class="n">vips_error_exit</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
<span class="w">        </span><span class="n">vips_error_exit</span><span class="p">(</span><span class="s">&quot;usage: %s infile outfile&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vips_image_new_from_file</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)))</span>
<span class="w">        </span><span class="n">vips_error_exit</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;image width = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">vips_image_get_width</span><span class="p">(</span><span class="n">in</span><span class="p">));</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">vips_avg</span><span class="p">(</span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">mean</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">))</span>
<span class="w">        </span><span class="n">vips_error_exit</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;mean pixel value = %g</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">vips_invert</span><span class="p">(</span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">))</span>
<span class="w">        </span><span class="n">vips_error_exit</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">    </span><span class="n">g_object_unref</span><span class="p">(</span><span class="n">in</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">vips_image_write_to_file</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="nb">NULL</span><span class="p">))</span>
<span class="w">        </span><span class="n">vips_error_exit</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">    </span><span class="n">g_object_unref</span><span class="p">(</span><span class="n">out</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="reference-pools">Reference pools<a class="md-anchor" href="#reference-pools" title="Permanent link"></a></h2>
<p>libvips has a simple system to automate at least some reference counting
issues. Reference pools are arrays of object pointers which will be released
automatically when some other object is&nbsp;finalized.</p>
<p>The code below crops a many-page image (perhaps a <span class="caps">GIF</span> or <span class="caps">PDF</span>). It splits the
image into separate pages, crops each page, reassembles the cropped areas,
and saves again. It creates a <code>context</code> object representing the state of
processing, and <code>crop_animation</code> allocates two reference pools off that
using <a href="method.Object.local_array.html"><code>vips_object_local_array()</code></a>, one to hold the cropped frames, and one
to assemble and copy the&nbsp;result.</p>
<p>All unreffing is handled by <code>main</code>, and it doesn&#8217;t need to know anything
about <code>crop_animation</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vips/vips.h&gt;</span>

<span class="k">static</span><span class="w"> </span><span class="kt">int</span>
<span class="nf">crop_animation</span><span class="p">(</span><span class="n">VipsObject</span><span class="w"> </span><span class="o">*</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">VipsImage</span><span class="w"> </span><span class="o">*</span><span class="n">image</span><span class="p">,</span><span class="w"> </span><span class="n">VipsImage</span><span class="w"> </span><span class="o">**</span><span class="n">out</span><span class="p">,</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">left</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">top</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">height</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">page_height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vips_image_get_page_height</span><span class="p">(</span><span class="n">image</span><span class="p">);</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">n_pages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">image</span><span class="o">-&gt;</span><span class="n">Ysize</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">page_height</span><span class="p">;</span>
<span class="w">    </span><span class="n">VipsImage</span><span class="w"> </span><span class="o">**</span><span class="n">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">VipsImage</span><span class="w"> </span><span class="o">**</span><span class="p">)</span><span class="w"> </span><span class="n">vips_object_local_array</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">n_pages</span><span class="p">);</span>
<span class="w">    </span><span class="n">VipsImage</span><span class="w"> </span><span class="o">**</span><span class="n">copy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">VipsImage</span><span class="w"> </span><span class="o">**</span><span class="p">)</span><span class="w"> </span><span class="n">vips_object_local_array</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>

<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* Split the image into cropped frames.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n_pages</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">vips_crop</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">page</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
<span class="w">                </span><span class="n">left</span><span class="p">,</span><span class="w"> </span><span class="n">page_height</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">top</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">))</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* Reassemble the frames and set the page height. You must copy before</span>
<span class="cm">     * modifying metadata.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">vips_arrayjoin</span><span class="p">(</span><span class="n">page</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">copy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">n_pages</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;across&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">||</span>
<span class="w">        </span><span class="n">vips_copy</span><span class="p">(</span><span class="n">copy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">))</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">    </span><span class="n">vips_image_set_int</span><span class="p">(</span><span class="o">*</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;page-height&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span>
<span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">VipsImage</span><span class="w"> </span><span class="o">*</span><span class="n">image</span><span class="p">;</span>
<span class="w">    </span><span class="n">VipsObject</span><span class="w"> </span><span class="o">*</span><span class="n">context</span><span class="p">;</span>
<span class="w">    </span><span class="n">VipsImage</span><span class="w"> </span><span class="o">*</span><span class="n">x</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">VIPS_INIT</span><span class="p">(</span><span class="nb">NULL</span><span class="p">))</span>
<span class="w">        </span><span class="n">vips_error_exit</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vips_image_new_from_file</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<span class="w">              </span><span class="s">&quot;access&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">VIPS_ACCESS_SEQUENTIAL</span><span class="p">,</span>
<span class="w">              </span><span class="nb">NULL</span><span class="p">)))</span>
<span class="w">        </span><span class="n">vips_error_exit</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">    </span><span class="n">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VIPS_OBJECT</span><span class="p">(</span><span class="n">vips_image_new</span><span class="p">());</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">crop_animation</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">image</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">500</span><span class="p">,</span><span class="w"> </span><span class="mi">500</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">g_object_unref</span><span class="p">(</span><span class="n">image</span><span class="p">);</span>
<span class="w">        </span><span class="n">g_object_unref</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>
<span class="w">        </span><span class="n">vips_error_exit</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">g_object_unref</span><span class="p">(</span><span class="n">image</span><span class="p">);</span>
<span class="w">    </span><span class="n">g_object_unref</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>
<span class="w">    </span><span class="n">image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">vips_image_write_to_file</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="nb">NULL</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">g_object_unref</span><span class="p">(</span><span class="n">image</span><span class="p">);</span>
<span class="w">        </span><span class="n">vips_error_exit</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">g_object_unref</span><span class="p">(</span><span class="n">image</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
    </div>
  </section>
</section>


    
<div id="toc" class="toc">
  <nav aria-labelledby="toc-title">
    <p id="toc-title">Content</p>
    <ul class="toc-list">
      
        
        <li class="toc-list-item"><a href="#library-startup"><span class="link-text">Library startup</span></a></li>
          
        
        <li class="toc-list-item"><a href="#the-vipsimage-class"><span class="link-text">The VipsImage class</span></a></li>
          
        
        <li class="toc-list-item"><a href="#reference-counting"><span class="link-text">Reference counting</span></a></li>
          
        
        <li class="toc-list-item"><a href="#libvips-operations"><span class="link-text">libvips operations</span></a></li>
          
        
        <li class="toc-list-item"><a href="#getting-pixels"><span class="link-text">Getting pixels</span></a></li>
          
        
        <li class="toc-list-item"><a href="#error-handling"><span class="link-text">Error handling</span></a></li>
          
        
        <li class="toc-list-item"><a href="#example"><span class="link-text">Example</span></a></li>
          
        
        <li class="toc-list-item"><a href="#libvips-from-c-example"><span class="link-text">libvips from C example</span></a></li>
          
        
        <li class="toc-list-item"><a href="#reference-pools"><span class="link-text">Reference pools</span></a></li>
          
        
      
    </ul>
  </nav>
</div>


    <section id="search" class="content hidden"></section>

    <footer>
    
    </footer>
  </div>
</body>
</html>