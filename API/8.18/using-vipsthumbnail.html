<!--
SPDX-FileCopyrightText: libvips team and contributors

SPDX-License-Identifier: LGPL-2.1-or-later
-->

<!DOCTYPE html>
<html lang="en">
<head>
  <title>Vips &ndash; 8.0: Using &gt; vipsthumbnail</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta charset="utf-8" />

  
  <meta property="og:type" content="website"/>

  

  
  <meta property="og:title" content="Vips: Using &gt; vipsthumbnail"/>
  <meta property="og:description" content="Reference for Vips-8.0: Using &gt; vipsthumbnail"/>
  <meta name="twitter:title" content="Vips: Using &gt; vipsthumbnail"/>
  <meta name="twitter:description" content="Reference for Vips-8.0: Using &gt; vipsthumbnail"/>


  
  <meta name="twitter:card" content="summary"/>

  
  
  
  <link rel="search" type="application/opensearchdescription+xml" title="Vips" href="opensearch.xml">
  
  

  <link rel="stylesheet" href="style.css" type="text/css" />

  

  
  <script src="urlmap.js"></script>
  
  
  <script src="fzy.js"></script>
  <script src="search.js"></script>
  
  <script src="main.js"></script>

  
</head>

<body>
  <div id="body-wrapper" tabindex="-1">

    <nav class="sidebar devhelp-hidden">
      
      
      <div class="search section">
        <form id="search-form" autocomplete="off">
          <input id="search-input" type="text" name="do-not-autocomplete" placeholder="Click, or press 's' to search" autocomplete="off"/>
        </form>
      </div>
      
      <div class="section namespace">
        <h3><a href="index.html">Vips</a></h3>
        <p>API Version: 8.0</p>
        
        <p>Library Version: 8.18</p>
        
      </div>
      
      
      <div class="section generator">
        <p>Generated by <a href="https://gitlab.gnome.org/GNOME/gi-docgen">gi-docgen</a> 2025.3</p>
      </div>
    </nav>

    <button id="btn-to-top" class="hidden"><span class="up-arrow"></span></button>

    
<section id="main" class="content">
  
  <h4 id="title" style="display:flex;">
    Using &gt; vipsthumbnail
    <a href="#title" class="anchor"></a>
    
    <a class="srclink" title="go to source location" href="https://github.com/libvips/libvips/blob/master/doc/using-vipsthumbnail.md">[src]</a>
    
  </h4>
  
  <section>
    <div class="docblock">
    <p>libvips ships with a handy command-line image thumbnailer, <code>vipsthumbnail</code>.
This page introduces it, with some&nbsp;examples.</p>
<p>The thumbnailing functionality is implemented by <a href="ctor.Image.thumbnail.html"><code>vips_thumbnail()</code></a>,
see the docs for details. You can it from any language
with a libvips binding. For example, from <span class="caps">PHP</span> you could&nbsp;write:</p>
<div class="codehilite"><pre><span></span><code><span class="x">$filename = &quot;image.jpg&quot;;</span>
<span class="x">$image = Vips\Image::thumbnail($filename, 200, [&quot;height&quot; =&gt; 200]);</span>
<span class="x">$image-&gt;writeToFile(&quot;my-thumbnail.jpg&quot;);</span>
</code></pre></div>

<p>You can also call <code>thumbnail_source</code> from the <span class="caps">CLI</span>, for&nbsp;example:</p>
<div class="codehilite"><pre><span></span><code><span class="gp">$ </span>cat<span class="w"> </span>k2.jpg<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>vips<span class="w"> </span>thumbnail_source<span class="w"> </span><span class="o">[</span><span class="nv">descriptor</span><span class="o">=</span><span class="m">0</span><span class="o">]</span><span class="w"> </span>.jpg<span class="o">[</span><span class="nv">Q</span><span class="o">=</span><span class="m">90</span><span class="o">]</span><span class="w"> </span><span class="m">128</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>cat<span class="w"> </span>&gt;<span class="w"> </span>x.jpg
</code></pre></div>

<p>To thumbnail directly between a pair of&nbsp;pipes.</p>
<h2 id="libvips-options">libvips options<a class="md-anchor" href="#libvips-options" title="Permanent link"></a></h2>
<p><code>vipsthumbnail</code> supports the usual range of <code>vips</code> command-line options. A
few of them are&nbsp;useful:</p>
<p><code>--vips-cache-trace</code> shows each operation as libvips starts it. It can be
handy to see exactly what operations <code>vipsthumbnail</code> is running for&nbsp;you.</p>
<p><code>--vips-leak</code> turns on the libvips memory leak checker. As well as reporting
leaks (hopefully there are none) it also tracks and reports peak memory&nbsp;use.</p>
<p><code>--vips-progress</code> runs a progress indicator during computation. It can be
useful to see where libvips is looping and how&nbsp;often.</p>
<p><code>--vips-info</code> shows a higher level view of the operations that <code>vipsthumbnail</code>
is&nbsp;running.</p>
<h2 id="looping">Looping<a class="md-anchor" href="#looping" title="Permanent link"></a></h2>
<p><code>vipsthumbnail</code> can process many images in one command. For&nbsp;example:</p>
<div class="codehilite"><pre><span></span><code><span class="gp">$ </span>vipsthumbnail<span class="w"> </span>*.jpg
</code></pre></div>

<p>will make a thumbnail for every <span class="caps">JPEG</span> in the current directory. See the
<a href="#path-option">Path option</a> section below to see how to control
where thumbnails are&nbsp;written.</p>
<p><code>vipsthumbnail</code> will process images one after the other. You can get a good
speedup by running several <code>vipsthumbnail</code>s in parallel, depending on how
much load you want to put on your system. For&nbsp;example:</p>
<div class="codehilite"><pre><span></span><code><span class="gp">$ </span>parallel<span class="w"> </span>vipsthumbnail<span class="w"> </span>:::<span class="w"> </span>*.jpg
</code></pre></div>

<h2 id="thumbnail-size">Thumbnail size<a class="md-anchor" href="#thumbnail-size" title="Permanent link"></a></h2>
<p>You can set the bounding box of the generated thumbnail with the <code>--size</code>
option. For&nbsp;example:</p>
<div class="codehilite"><pre><span></span><code><span class="gp">$ </span>vipsthumbnail<span class="w"> </span>shark.jpg<span class="w"> </span>--size<span class="w"> </span>200x100
</code></pre></div>

<p>Use a single number to set a square bounding box. You can omit either number
but keep the x to mean resize just based on that axis, for&nbsp;example:</p>
<div class="codehilite"><pre><span></span><code><span class="gp">$ </span>vipsthumbnail<span class="w"> </span>shark.jpg<span class="w"> </span>--size<span class="w"> </span>200x
</code></pre></div>

<p>Will resize to 200 pixels across, no matter what the height of the input image&nbsp;is.</p>
<p>You can append <code>&lt;</code> or <code>&gt;</code> to mean only resize if the image is smaller or larger
than the&nbsp;target.</p>
<p>You can append <code>!</code> to force a resize to the exact target size, breaking
the aspect&nbsp;ratio.</p>
<h2 id="cropping">Cropping<a class="md-anchor" href="#cropping" title="Permanent link"></a></h2>
<p><code>vipsthumbnail</code> normally shrinks images to fit within the box set by <code>--size</code>.
You can use the <code>--smartcrop</code> option to crop to fill the box instead. Excess
pixels are trimmed away using the strategy you set. For&nbsp;example:</p>
<div class="codehilite"><pre><span></span><code><span class="gp">$ </span>vipsthumbnail<span class="w"> </span>owl.jpg<span class="w"> </span>--smartcrop<span class="w"> </span>attention<span class="w"> </span>-s<span class="w"> </span><span class="m">128</span>
</code></pre></div>

<p>Where <code>owl.jpg</code> is an off-centre&nbsp;composition:</p>
<p><img alt="Owl" src="owl.jpg" /></p>
<p>Gives this&nbsp;result:</p>
<p><img alt="Smartcrop" src="tn_owl.jpg" /></p>
<p>First it shrinks the image to get the vertical axis to 128 pixels, then crops
down to 128 pixels across using the <code>attention</code> strategy. This one searches
the image for features which might catch a human eye, see
<a href="method.Image.smartcrop.html"><code>vips_smartcrop()</code></a> for&nbsp;details.</p>
<h2 id="linear-light">Linear light<a class="md-anchor" href="#linear-light" title="Permanent link"></a></h2>
<p>Shrinking images involves combining many pixels into one. Arithmetic
averaging really ought to be in terms of the number of photons, but for
historical reasons the values stored in image files are usually related
to the voltage that should be applied to the electron gun in a <span class="caps">CRT</span>&nbsp;display.</p>
<p><code>vipsthumbnail</code> has an option to perform image shrinking in linear space, that
is, a colourspace where values are proportional to photon numbers. For&nbsp;example:</p>
<div class="codehilite"><pre><span></span><code><span class="gp">$ </span>vipsthumbnail<span class="w"> </span>fred.jpg<span class="w"> </span>--linear
</code></pre></div>

<p>The downside is that in linear mode none of the very fast shrink-on-load
tricks that <code>vipsthumbnail</code> normally uses are possible, since the shrinking is
done at encode time, not decode time, and is done in terms of <span class="caps">CRT</span> voltage, not
photons. This can make linear light thumbnailing of large images&nbsp;slow.</p>
<p>For example, for a 10,000 x 10,000 pixel <span class="caps">JPEG</span> I&nbsp;see:</p>
<div class="codehilite"><pre><span></span><code><span class="gp">$ </span><span class="nb">time</span><span class="w"> </span>vipsthumbnail<span class="w"> </span>wtc.jpg
<span class="go">real    0m0.317s</span>
<span class="go">user    0m0.292s</span>
<span class="go">sys 0m0.016s</span>
<span class="gp">$ </span><span class="nb">time</span><span class="w"> </span>vipsthumbnail<span class="w"> </span>wtc.jpg<span class="w"> </span>--linear
<span class="go">real    0m4.660s</span>
<span class="go">user    0m4.640s</span>
<span class="go">sys 0m0.016s</span>
</code></pre></div>

<h2 id="path-option">Path option<a class="md-anchor" href="#path-option" title="Permanent link"></a></h2>
<p>Use <code>--path</code> to control where and how the thumbnail is&nbsp;written.</p>
<p>Three substitutions are performed on the argument: <code>%s</code> is  replaced by
the input basename with any suffix removed, <code>%d</code> is replaced by the input
dirname, and <code>%c</code> is replaced by the current working&nbsp;directory.</p>
<p>The default value is  <code>%d/tn_%s.jpg</code> meaning <span class="caps">JPEG</span> output, to the same
directory as the input file, with <code>tn_</code> prepended. You can add format options
too, for example <code>%c/%s/tn_%s.jpg[Q=20]</code> will  write <span class="caps">JPEG</span>  images to a tree
within the current directory with <code>Q</code> set to 20, or <code>tn_%s.png</code> will write
thumbnails as <span class="caps">PNG</span>&nbsp;images.</p>
<p>The <code>keep</code> option to savers is especially useful. Many image have very
large <span class="caps">IPTC</span>, <span class="caps">ICC</span> or <span class="caps">XMP</span> metadata items embedded in them, and removing these
can give a large&nbsp;saving.</p>
<p>For&nbsp;example:</p>
<div class="codehilite"><pre><span></span><code><span class="gp">$ </span>vipsthumbnail<span class="w"> </span><span class="m">42</span>-32157534.jpg
<span class="gp">$ </span>ls<span class="w"> </span>-l<span class="w"> </span>tn_42-32157534.jpg
<span class="go">-rw-r–r– 1 john john 6682 Nov 12 21:27 tn_42-32157534.jpg</span>
</code></pre></div>

<p><code>keep=none</code> almost halves the size of the&nbsp;thumbnail:</p>
<div class="codehilite"><pre><span></span><code><span class="gp">$ </span>vipsthumbnail<span class="w"> </span><span class="m">42</span>-32157534.jpg<span class="w"> </span>-path<span class="w"> </span>x.jpg<span class="o">[</span>optimize_coding,keep<span class="o">=</span>none<span class="o">]</span>
<span class="gp">$ </span>ls<span class="w"> </span>-l<span class="w"> </span>x.jpg
<span class="go">-rw-r–r– 1 john john 3600 Nov 12 21:27 x.jpg</span>
</code></pre></div>

<h2 id="colour-management">Colour management<a class="md-anchor" href="#colour-management" title="Permanent link"></a></h2>
<p><code>vipsthumbnail</code> will optionally put images through LittleCMS for you. You can
use this to move all thumbnails to the same colour space. All web browsers
assume that images without an <span class="caps">ICC</span> profile are in sRGB colourspace, so if
you move your thumbnails to sRGB, you can strip all the embedded profiles.
This can save several kb per&nbsp;thumbnail.</p>
<p>For&nbsp;example:</p>
<div class="codehilite"><pre><span></span><code><span class="gp">$ </span>vipsthumbnail<span class="w"> </span>shark.jpg
<span class="gp">$ </span>ls<span class="w"> </span>-l<span class="w"> </span>tn_shark.jpg
<span class="go">-rw-r–r– 1 john john 7295 Nov  9 14:33 tn_shark.jpg</span>
</code></pre></div>

<p>Now transform to sRGB and don&#8217;t attach a profile (you can also use
<code>keep=none</code>, though that will remove <em>all</em> metadata from the&nbsp;image):</p>
<div class="codehilite"><pre><span></span><code><span class="gp">$ </span>vipsthumbnail<span class="w"> </span>shark.jpg<span class="w"> </span>--output-profile<span class="w"> </span>srgb<span class="w"> </span>--path<span class="w"> </span>tn_shark.jpg<span class="o">[</span><span class="nv">profile</span><span class="o">=</span>none<span class="o">]</span>
<span class="gp">$ </span>ls<span class="w"> </span>-l<span class="w"> </span>tn_shark.jpg
<span class="go">-rw-r–r– 1 john john 4229 Nov  9 14:33 tn_shark.jpg</span>
</code></pre></div>

<p>(You can use the filename of any <span class="caps">RGB</span> profile. The magic string <code>srgb</code> selects a
high-quality sRGB profile that&#8217;s built into&nbsp;libvips.)</p>
<p><code>tn_shark.jpg</code> will look identical to a user, but it&#8217;s almost half the&nbsp;size.</p>
<p>You can also specify a fallback input profile to use if the image has no
embedded one. For example, perhaps you somehow know that a <span class="caps">JPEG</span> is in Adobe98
space, even though it has no embedded&nbsp;profile.</p>
<div class="codehilite"><pre><span></span><code><span class="gp">$ </span>vipsthumbnail<span class="w"> </span>kgdev.jpg<span class="w"> </span>--input-profile<span class="w"> </span>/my/profiles/a98.icm
</code></pre></div>

<h2 id="final-suggestion">Final suggestion<a class="md-anchor" href="#final-suggestion" title="Permanent link"></a></h2>
<p>Putting all this together, I suggest this as a sensible set of&nbsp;options:</p>
<div class="codehilite"><pre><span></span><code><span class="gp">$ </span>vipsthumbnail<span class="w"> </span>fred.jpg<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--size<span class="w"> </span><span class="m">128</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--output-profile<span class="w"> </span>srgb<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--path<span class="w"> </span>tn_%s.jpg<span class="o">[</span>optimize_coding,keep<span class="o">=</span>none<span class="o">]</span>
</code></pre></div>
    </div>
  </section>
</section>


    
<div id="toc" class="toc">
  <nav aria-labelledby="toc-title">
    <p id="toc-title">Content</p>
    <ul class="toc-list">
      
        
        <li class="toc-list-item"><a href="#libvips-options"><span class="link-text">libvips options</span></a></li>
          
        
        <li class="toc-list-item"><a href="#looping"><span class="link-text">Looping</span></a></li>
          
        
        <li class="toc-list-item"><a href="#thumbnail-size"><span class="link-text">Thumbnail size</span></a></li>
          
        
        <li class="toc-list-item"><a href="#cropping"><span class="link-text">Cropping</span></a></li>
          
        
        <li class="toc-list-item"><a href="#linear-light"><span class="link-text">Linear light</span></a></li>
          
        
        <li class="toc-list-item"><a href="#path-option"><span class="link-text">Path option</span></a></li>
          
        
        <li class="toc-list-item"><a href="#colour-management"><span class="link-text">Colour management</span></a></li>
          
        
        <li class="toc-list-item"><a href="#final-suggestion"><span class="link-text">Final suggestion</span></a></li>
          
        
      
    </ul>
  </nav>
</div>


    <section id="search" class="content hidden"></section>

    <footer>
    
    </footer>
  </div>
</body>
</html>