<!DOCTYPE html>
<html lang="en-us">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="UTF-8">
    <title>libvips</title>
    <meta name="description" content="A fast image processing library with low memory needs.">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Cabin:400,700" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name"><a href="/">libvips</a></h1>
      <h2 class="project-tagline">A fast image processing library with low memory needs.</h2>

      <a href="https://github.com/libvips/libvips/releases" class="btn">Download</a>
      <a href="/install.html" class="btn">Install</a>
      <a href="/API/current" class="btn">Documentation</a>
      <a href="https://github.com/libvips/libvips/issues" class="btn">Issues</a>
      <a href="https://github.com/libvips/libvips/wiki" class="btn">Wiki</a>
      <a href="https://github.com/libvips" class="btn">libvips projects</a>
      <a href="https://github.com/libvips/libvips" class="btn">libvips on GitHub</a>

    </section>

    <section class="main-content">
<table class="navigation" id="top" width="100%" summary="Navigation header" cellpadding="2" cellspacing="5"><tr valign="middle">
<td width="100%" align="left" class="shortcuts"></td>
<td><a accesskey="h" href="index.html"><img src="home.png" width="16" height="16" border="0" alt="Home"></a></td>
<td><a accesskey="u" href="ch01.html"><img src="up.png" width="16" height="16" border="0" alt="Up"></a></td>
<td><a accesskey="p" href="Making-image-pyramids.html"><img src="left.png" width="16" height="16" border="0" alt="Prev"></a></td>
<td><a accesskey="n" href="Examples.html"><img src="right.png" width="16" height="16" border="0" alt="Next"></a></td>
</tr></table>
<div class="refentry">
<a name="Using-vipsthumbnail"></a><div class="titlepage"></div>
<p>
  
</p>
<p>
  </p>
<div class="refnamediv"><table width="100%"><tr>
<td valign="top">
<h2><code class="literal">vipsthumbnail</code></h2>
<p><code class="literal">vipsthumbnail</code> — Introduction to <code class="literal">vipsthumbnail</code>, with examples</p>
</td>
<td class="gallery_image" valign="top" align="right"></td>
</tr></table></div>
<p>
</p>
<p>
  libvips ships with a handy command-line image thumbnailer, <code class="literal">vipsthumbnail</code>. This page introduces it, with some examples.
</p>
<p>
  The thumbnailing functionality is implemented by <code class="literal">vips_thumbnail()</code> and <code class="literal">vips_thumbnail_buffer()</code> (which thumbnails an image held as a string), see the docs for details. You can use these functions from any language with a libvips binding. For example, from PHP you could write:
</p>
<pre class="programlisting">
$filename = "image.jpg";
$image = Vips\Image::thumbnail($filename, 200, ["height" =&gt; 200]);
$image-&gt;writeToFile("my-thumbnail.jpg");
</pre>
<p>
  You can also call <code class="literal">thumbnail_source</code> from the CLI, for example:
</p>
<pre class="programlisting">
$ cat k2.jpg | \
    vips thumbnail_source [descriptor=0] .jpg[Q=90] 128 | \
    cat &gt; x.jpg
</pre>
<div class="refsect3">
<a name="libvips-options"></a><h4>libvips options</h4>
<p>
    <code class="literal">vipsthumbnail</code> supports the usual range of vips command-line options. A few of them are useful:
  </p>
<p>
    <code class="literal">--vips-cache-trace</code> shows each operation as libvips starts it. It can be handy to see exactly what operations <code class="literal">vipsthumbnail</code> is running for you.
  </p>
<p>
    <code class="literal">--vips-leak</code> turns on the libvips memory leak checker. As well as reporting leaks (hopefully there are none) it also tracks and reports peak memory use.
  </p>
<p>
    <code class="literal">--vips-progress</code> runs a progress indicator during computation. It can be useful to see where libvips is looping and how often.
  </p>
<p>
    <code class="literal">--vips-info</code> shows a higher level view of the operations that <code class="literal">vipsthumbnail</code> is running. 
  </p>
</div>
<div class="refsect3">
<a name="looping"></a><h4>Looping</h4>
<p>
    <code class="literal">vipsthumbnail</code> can process many images in one command. For example:
  </p>
<pre class="programlisting">
$ vipsthumbnail *.jpg
</pre>
<p>
    will make a thumbnail for every jpeg in the current directory.  See the <a class="link" href="Using-vipsthumbnail.html#output-directory" title="Output directory">Output directory</a> section below to see how to change where thumbnails are written.
  </p>
<p>
    <code class="literal">vipsthumbnail</code> will process images one after the other. You can get a good speedup by running several <code class="literal">vipsthumbnail</code>s in parallel, depending on how much load you want to put on your system. For example:
  </p>
<pre class="programlisting">
$ parallel vipsthumbnail ::: *.jpg
</pre>
</div>
<div class="refsect3">
<a name="thumbnail-size"></a><h4>Thumbnail size</h4>
<p>
    You can set the bounding box of the generated thumbnail with the <code class="literal">--size</code> option. For example:
  </p>
<pre class="programlisting">
$ vipsthumbnail shark.jpg --size 200x100
</pre>
<p>
    Use a single number to set a square bounding box. You can omit either number but keep the x to mean resize just based on that axis, for example:
  </p>
<pre class="programlisting">
$ vipsthumbnail shark.jpg --size 200x
</pre>
<p>
    Will resize to 200 pixels across, no matter what the height of the input image is.
  </p>
<p>
    You can append <code class="literal">&lt;</code> or <code class="literal">&gt;</code> to mean only resize if the image is smaller or larger than the target.
  </p>
<p>
    You can append <code class="literal">!</code> to force a resize to the exact target size, breaking the aspect ratio.
  </p>
</div>
<div class="refsect3">
<a name="cropping"></a><h4>Cropping</h4>
<p>
    <code class="literal">vipsthumbnail</code> normally shrinks images to fit within the box set by <code class="literal">--size</code>. You can use the <code class="literal">--smartcrop</code> option to crop to fill the box instead. Excess pixels are trimmed away using the strategy you set. For example:
  </p>
<pre class="programlisting">
$ vipsthumbnail owl.jpg --smartcrop attention -s 128
</pre>
<p>
    Where <code class="literal">owl.jpg</code> is an off-centre composition:
  </p>
<p>
    <span class="inlinemediaobject"><img src="owl.jpg"></span>
  </p>
<p>
    Gives this result:
  </p>
<p>
    <span class="inlinemediaobject"><img src="tn_owl.jpg"></span>
  </p>
<p>
    First it shrinks the image to get the vertical axis to 128 pixels, then crops down to 128 pixels across using the <code class="literal">attention</code> strategy. This one searches the image for features which might catch a human eye, see <code class="literal">vips_smartcrop()</code> for details.
  </p>
</div>
<div class="refsect3">
<a name="linear-light"></a><h4>Linear light</h4>
<p>
    Shrinking images involves combining many pixels into one. Arithmetic averaging really ought to be in terms of the number of photons, but (for historical reasons) the values stored in image files are usually related to the voltage that should be applied to the electron gun in a CRT display.
  </p>
<p>
    <code class="literal">vipsthumbnail</code> has an option to perform image shrinking in linear space, that is, a colourspace where values are proportional to photon numbers. For example:
  </p>
<pre class="programlisting">
$ vipsthumbnail fred.jpg --linear
</pre>
<p>
    The downside is that in linear mode, none of the very fast shrink-on-load tricks that <code class="literal">vipsthumbnail</code> normally uses are possible, since the shrinking is done at encode time, not decode time, and is done in terms of CRT voltage, not photons. This can make linear light thumbnailing of large images extremely slow.
  </p>
<p>
    For example, for a 10,000 x 10,000 pixel JPEG I see:
  </p>
<pre class="programlisting">
$ time vipsthumbnail wtc.jpg 
real    0m0.317s
user    0m0.292s
sys 0m0.016s
$ time vipsthumbnail wtc.jpg --linear
real    0m4.660s
user    0m4.640s
sys 0m0.016s
</pre>
</div>
<div class="refsect3">
<a name="output-directory"></a><h4>Output directory</h4>
<p>
    You set the thumbnail write parameters with the <code class="literal">-o</code> option. This is a pattern which the input filename is pasted into to produce the output filename. For example:
  </p>
<pre class="programlisting">
$ vipsthumbnail fred.jpg jim.tif -o tn_%s.jpg
</pre>
<p>
    For each of the files to be thumbnailed, <code class="literal">vipsthumbnail</code> will drop the extension (<code class="literal">.jpg</code> and <code class="literal">.tif</code> in this case) and then substitute the name into the <code class="literal">-o</code> option, replacing the <code class="literal">%s</code> So this example will write thumbnails to <code class="literal">tn_fred.jpg</code> and <code class="literal">tn_jim.jpg</code>.
  </p>
<p>
    If the pattern given to <code class="literal">-o</code> is an absolute path, any path components are dropped from the input filenames. This lets you write all of your thumbnails to a specific directory, if you want. For example:
  </p>
<pre class="programlisting">
$ vipsthumbnail fred.jpg ../jim.tif -o /mythumbs/tn_%s.jpg
</pre>
<p>
    Now both thumbnails will be written to <code class="literal">/mythumbs</code>, even though the source images are in different directories.
  </p>
<p>
    Conversely, if <code class="literal">-o</code> is set to a relative path, any path component from the input file is prepended. For example:
  </p>
<pre class="programlisting">
$ vipsthumbnail fred.jpg ../jim.tif -o mythumbs/tn_%s.jpg
</pre>
<p>
    Now both input files will have thumbnails written to a subdirectory of their current directory.
  </p>
</div>
<div class="refsect3">
<a name="output-format-and-options"></a><h4>Output format and options</h4>
<p>
    You can use <code class="literal">-o</code> to specify the thumbnail image format too. For example: 
  </p>
<pre class="programlisting">
$ vipsthumbnail fred.jpg ../jim.tif -o tn_%s.png
</pre>
<p>
    Will write thumbnails in PNG format.
  </p>
<p>
    You can give options to the image write operation as a list of comma-separated arguments in square brackets. For example:
  </p>
<pre class="programlisting">
$ vipsthumbnail fred.jpg ../jim.tif -o tn_%s.jpg[Q=90,optimize_coding]
</pre>
<p>
    will write jpeg images with quality 90, and will turn on the libjpeg coding optimizer.
  </p>
<p>
    Check the image write operations to see all the possible options. For example:
  </p>
<pre class="programlisting">
$ vips jpegsave
save image to jpeg file
usage:
   jpegsave in filename
where:
   in           - Image to save, input VipsImage
   filename     - Filename to save to, input gchararray
optional arguments:
   Q            - Q factor, input gint
            default: 75
            min: 1, max: 100
   profile      - Filename of ICC profile to embed, input gchararray
   optimize-coding - Compute optimal Huffman coding tables, input gboolean
            default: false
   interlace    - Generate an interlaced (progressive) jpeg, input gboolean
            default: false
   trellis-quant - Apply trellis quantisation to each 8x8 block, input gboolean
            default: false
   overshoot-deringing - Apply overshooting to samples with extreme values, input gboolean
            default: false
   optimize-scans - Split spectrum of DCT coefficients into separate scans, input gboolean
            default: false
   quant-table  - Use predefined quantization table with given index, input gint
            default: 0
            min: 0, max: 8
   subsample-mode - Select chroma subsample operation mode, input VipsForeignSubsample
            default enum: auto
            allowed enums: auto, on, off
   restart-interval - Add restart markers every specified number of mcu, input gint
            default: 0
            min: 0, max: 2147483647
   keep         - Which metadata to retain, input VipsForeignKeep
            default flags: exif:xmp:iptc:icc:other:all
            allowed flags: none, exif, xmp, iptc, icc, other, all
   background   - Background value, input VipsArrayDouble
</pre>
<p>
    The <code class="literal">keep</code> option is especially useful. Many image have very large IPTC, ICC or XMP metadata items embedded in them, and removing these can give a large saving.
  </p>
<p>
    For example:
  </p>
<pre class="programlisting">
$ vipsthumbnail 42-32157534.jpg
$ ls -l tn_42-32157534.jpg
-rw-r–r– 1 john john 6682 Nov 12 21:27 tn_42-32157534.jpg
</pre>
<p>
    <code class="literal">keep=none</code> almost halves the size of the thumbnail:
  </p>
<pre class="programlisting">
$ vipsthumbnail 42-32157534.jpg -o x.jpg[optimize_coding,keep=none]
$ ls -l x.jpg
-rw-r–r– 1 john john 3600 Nov 12 21:27 x.jpg
</pre>
</div>
<div class="refsect3">
<a name="colour-management"></a><h4>Colour management</h4>
<p>
    <code class="literal">vipsthumbnail</code> will optionally put images through LittleCMS for you. You can use this to move all thumbnails to the same colour space. All web browsers assume that images without an ICC profile are in sRGB colourspace, so if you move your thumbnails to sRGB, you can strip all the embedded profiles. This can save several kb per thumbnail.
  </p>
<p>
    For example:
  </p>
<pre class="programlisting">
$ vipsthumbnail shark.jpg
$ ls -l tn_shark.jpg 
-rw-r–r– 1 john john 7295 Nov  9 14:33 tn_shark.jpg
</pre>
<p>
    Now transform to sRGB and don’t attach a profile (you can also use <code class="literal">keep=none</code>, though that will remove <span class="emphasis"><em>all</em></span> metadata from the image):
  </p>
<pre class="programlisting">
$ vipsthumbnail shark.jpg --export-profile srgb -o tn_shark.jpg[profile=none]
$ ls -l tn_shark.jpg 
-rw-r–r– 1 john john 4229 Nov  9 14:33 tn_shark.jpg
</pre>
<p>
    (You can use the filename of any RGB profile. The magic string <code class="literal">srgb</code> selects a high-quality sRGB profile that’s built into libvips.)
  </p>
<p>
    <code class="literal">tn_shark.jpg</code> will look identical to a user, but it’s almost half the size.
  </p>
<p>
    You can also specify a fallback input profile to use if the image has no embedded one. For example, perhaps you somehow know that a JPG is in Adobe98 space, even though it has no embedded profile.
  </p>
<pre class="programlisting">
$ vipsthumbnail kgdev.jpg --input-profile /my/profiles/a98.icm 
</pre>
</div>
<div class="refsect3">
<a name="final-suggestion"></a><h4>Final suggestion</h4>
<p>
    Putting all this together, I suggest this as a sensible set of options:
  </p>
<pre class="programlisting">
$ vipsthumbnail fred.jpg \
    --size 128 \
    --export-profile srgb \
    -o tn_%s.jpg[optimize_coding,keep=none] 
</pre>
</div>
</div>
<div class="footer">
<hr>Generated by GTK-Doc V1.34.0</div>
</section>

    <script type="text/javascript">
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-48550036-2', 'auto');
      ga('send', 'pageview');
    </script>
  </body>
</html>
