<!--
SPDX-FileCopyrightText: libvips team and contributors

SPDX-License-Identifier: LGPL-2.1-or-later
-->

<!DOCTYPE html>
<html lang="en">
<head>
  <title>Vips &ndash; 8.0: Using &gt; Multipage and animated images</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta charset="utf-8" />

  
  <meta property="og:type" content="website"/>

  

  
  <meta property="og:title" content="Vips: Using &gt; Multipage and animated images"/>
  <meta property="og:description" content="Reference for Vips-8.0: Using &gt; Multipage and animated images"/>
  <meta name="twitter:title" content="Vips: Using &gt; Multipage and animated images"/>
  <meta name="twitter:description" content="Reference for Vips-8.0: Using &gt; Multipage and animated images"/>


  
  <meta name="twitter:card" content="summary"/>

  
  
  
  <link rel="search" type="application/opensearchdescription+xml" title="Vips" href="opensearch.xml">
  
  

  <link rel="stylesheet" href="style.css" type="text/css" />

  

  
  <script src="urlmap.js"></script>
  
  
  <script src="fzy.js"></script>
  <script src="search.js"></script>
  
  <script src="main.js"></script>

  
</head>

<body>
  <div id="body-wrapper" tabindex="-1">

    <nav class="sidebar devhelp-hidden">
      
      
      <div class="search section">
        <form id="search-form" autocomplete="off">
          <input id="search-input" type="text" name="do-not-autocomplete" placeholder="Click, or press 's' to search" autocomplete="off"/>
        </form>
      </div>
      
      <div class="section namespace">
        <h3><a href="index.html">Vips</a></h3>
        <p>API Version: 8.0</p>
        
        <p>Library Version: 8.17</p>
        
      </div>
      
      
      <div class="section generator">
        <p>Generated by <a href="https://gitlab.gnome.org/GNOME/gi-docgen">gi-docgen</a> 2025.3</p>
      </div>
    </nav>

    <button id="btn-to-top" class="hidden"><span class="up-arrow"></span></button>

    
<section id="main" class="content">
  
  <h4 id="title" style="display:flex;">
    Using &gt; Multipage and animated images
    <a href="#title" class="anchor"></a>
    
    <a class="srclink" title="go to source location" href="https://github.com/libvips/libvips/blob/master/doc/multipage-and-animated-images.md">[src]</a>
    
  </h4>
  
  <section>
    <div class="docblock">
    <p>libvips represents animated and multipage images as tall, thin strips of
frames, like a strip of movie film (or a roll of toilet paper). Special image
metadata items are used to hold the page height, the number of frames, and any
frame delay or loop&nbsp;settings.</p>
<p>At least the <span class="caps">JXL</span>, <span class="caps">GIF</span> and WebP loaders and savers support animation,
and the <span class="caps">TIFF</span>, <span class="caps">PDF</span>, <span class="caps">HEIC</span>, <span class="caps">AVIF</span> and <span class="caps">VIPS</span> loaders and savers support&nbsp;multipage.</p>
<h2 id="reading-multipage-images">Reading multipage images<a class="md-anchor" href="#reading-multipage-images" title="Permanent link"></a></h2>
<p>For example, at the command-line,&nbsp;try:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>vipsheader<span class="w"> </span>-a<span class="w"> </span>silver-gear-cogs-animation-5.gif<span class="o">[</span><span class="nv">n</span><span class="o">=</span>-1<span class="o">]</span>
silver-gear-cogs-animation-5.gif:<span class="w"> </span>281x2560<span class="w"> </span>uchar,<span class="w"> </span><span class="m">4</span><span class="w"> </span>bands,<span class="w"> </span>srgb,<span class="w"> </span>gifload
width:<span class="w"> </span><span class="m">281</span>
height:<span class="w"> </span><span class="m">2560</span>
bands:<span class="w"> </span><span class="m">4</span>
format:<span class="w"> </span>uchar
coding:<span class="w"> </span>none
interpretation:<span class="w"> </span>srgb
xoffset:<span class="w"> </span><span class="m">0</span>
yoffset:<span class="w"> </span><span class="m">0</span>
xres:<span class="w"> </span><span class="m">1</span>
yres:<span class="w"> </span><span class="m">1</span>
filename:<span class="w"> </span>silver-gear-cogs-animation-5.gif
vips-loader:<span class="w"> </span>gifload
page-height:<span class="w"> </span><span class="m">320</span>
n-pages:<span class="w"> </span><span class="m">8</span>
loop:<span class="w"> </span><span class="m">0</span>
delay:<span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="m">100</span>
background:<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span>
gif-palette:<span class="w"> </span>-12500671<span class="w"> </span>-11447983<span class="w"> </span>-723724<span class="w"> </span>-3289651<span class="w"> </span>-11974327<span class="w"> </span>-11711155<span class="w"> </span>-5395027<span class="w"> </span>-13027015<span class="w"> </span>-9276814<span class="w"> </span>-9408400<span class="w"> </span>-16777216<span class="w"> </span>-14079703<span class="w"> </span>-197380<span class="w"> </span>-12237499<span class="w"> </span>-5723992<span class="w"> </span>-526345<span class="w"> </span>-15592942<span class="w"> </span>-12763843<span class="w"> </span>-5921371<span class="w"> </span>-13750738<span class="w"> </span>-13553359<span class="w"> </span>-10592674<span class="w"> </span>-6908266<span class="w"> </span>-7829368<span class="w"> </span>-7960954<span class="w"> </span>-8158333<span class="w"> </span>-809254
bits-per-sample:<span class="w"> </span><span class="m">7</span>
palette:<span class="w"> </span><span class="m">1</span>
</code></pre></div>

<p>Points to&nbsp;note:</p>
<ul>
<li>
<p>By default, libvips will just read the first page from an animated or
  multipage image. You pass <code>[n=-1]</code> to the loader to get all pages (or
  frames) in the animation. You can pick out a single page or range of
  pages with perhaps <code>[page=4]</code> and <code>[page=2,n=2]</code>.</p>
</li>
<li>
<p><code>page-height</code> is the vertical size of each frame within the overall image
  (2560 pixels high in this&nbsp;case).</p>
</li>
<li>
<p><code>n-pages</code> is the number of pages (or frames) in this animation. Obviously
  <code>n-pages * frame-height == height</code>, or in this case 320 * 8 ==&nbsp;2560.</p>
</li>
<li>
<p><code>loop</code> is the number of times the animation should loop before stopping.
  Zero means &#8220;never stop&nbsp;looping&#8221;.</p>
</li>
<li>
<p><code>delay</code> is an optional array with a time in milliseconds which each frame
  should display&nbsp;for.</p>
</li>
</ul>
<p>You&#8217;ll see a similar set of metadata for a multipage image, such as a <span class="caps">PDF</span>:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>vipsheader<span class="w"> </span>-a<span class="w"> </span>nipguide.pdf<span class="o">[</span><span class="nv">n</span><span class="o">=</span>-1<span class="o">]</span>
nipguide.pdf:<span class="w"> </span>595x48836<span class="w"> </span>uchar,<span class="w"> </span><span class="m">4</span><span class="w"> </span>bands,<span class="w"> </span>srgb,<span class="w"> </span>pdfload
width:<span class="w"> </span><span class="m">595</span>
height:<span class="w"> </span><span class="m">48836</span>
bands:<span class="w"> </span><span class="m">4</span>
format:<span class="w"> </span>uchar
coding:<span class="w"> </span>none
interpretation:<span class="w"> </span>srgb
xoffset:<span class="w"> </span><span class="m">0</span>
yoffset:<span class="w"> </span><span class="m">0</span>
xres:<span class="w"> </span><span class="m">2</span>.83465
yres:<span class="w"> </span><span class="m">2</span>.83465
filename:<span class="w"> </span>nipguide.pdf
vips-loader:<span class="w"> </span>pdfload
page-height:<span class="w"> </span><span class="m">842</span>
pdf-n_pages:<span class="w"> </span><span class="m">58</span>
n-pages:<span class="w"> </span><span class="m">58</span>
pdf-creator:<span class="w"> </span>TeX
pdf-producer:<span class="w"> </span>pdfTeX-1.40.16
</code></pre></div>

<p>Now there&#8217;s no <code>loop</code> or <code>delay</code> since this is not animated, but <code>n-pages</code> and
<code>page-height</code> are set. In just the same way, you can load all pages, a single
page or a range of&nbsp;pages.</p>
<p>This all assumes that every page (or frame) has the same dimensions. If
they don&#8217;t (this can commonly happen with <span class="caps">PDF</span> and <span class="caps">TIFF</span>), you have to read
pages one by&nbsp;one.</p>
<h2 id="writing-multipage-images">Writing multipage images<a class="md-anchor" href="#writing-multipage-images" title="Permanent link"></a></h2>
<p>As long as these various pieces of metadata are set, you can write animated
and multipage images in the obvious way. For&nbsp;example:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>vips<span class="w"> </span>copy<span class="w"> </span>nipguide.pdf<span class="o">[</span><span class="nv">n</span><span class="o">=</span>-1<span class="o">]</span><span class="w"> </span>x.gif
</code></pre></div>

<p>This will take the 58-page <span class="caps">PDF</span> and render a 58-frame animation.  This only
works because this specific <span class="caps">PDF</span> has pages which are all the same size &#8212;
PDFs with (for example) a mix of portrait and landscape pages can&#8217;t be
handled like&nbsp;this.</p>
<p>More usefully, you could convert a <span class="caps">GIF</span> to WebP&nbsp;with:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>vips<span class="w"> </span>copy<span class="w"> </span>silver-gear-cogs-animation-5.gif<span class="o">[</span><span class="nv">n</span><span class="o">=</span>-1<span class="o">]</span><span class="w"> </span>silver.webp
</code></pre></div>

<p>To write an animated or multipage image programmatically, you need to
construct the tall, thin image and set the metadata. For&nbsp;example:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>vips<span class="w"> </span>arrayjoin<span class="w"> </span><span class="s2">&quot;k2.jpg k4a.png&quot;</span><span class="w"> </span>x.tif<span class="o">[</span>page-height<span class="o">=</span><span class="m">2048</span><span class="o">]</span><span class="w"> </span>--across<span class="o">=</span><span class="m">1</span>
</code></pre></div>

<p>Provided that the images are both 2048 pixels high, this will write a
two-page <span class="caps">TIFF</span>.</p>
<p>In Python you could write something&nbsp;like:</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/usr/bin/env python3</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">pyvips</span>

<span class="c1"># the input images -- assume these are all the same size</span>
<span class="n">images</span> <span class="o">=</span> <span class="p">[</span><span class="n">pyvips</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">new_from_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">access</span><span class="o">=</span><span class="s2">&quot;sequential&quot;</span><span class="p">)</span>
          <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">:]]</span>

<span class="c1"># frame delays are in milliseconds</span>
<span class="n">delay_array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">300</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">images</span><span class="p">)</span>

<span class="n">animation</span> <span class="o">=</span> <span class="n">pyvips</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">arrayjoin</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">across</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">animation</span><span class="o">.</span><span class="n">set_type</span><span class="p">(</span><span class="n">pyvips</span><span class="o">.</span><span class="n">GValue</span><span class="o">.</span><span class="n">gint_type</span><span class="p">,</span> <span class="s2">&quot;loop&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">animation</span><span class="o">.</span><span class="n">set_type</span><span class="p">(</span><span class="n">pyvips</span><span class="o">.</span><span class="n">GValue</span><span class="o">.</span><span class="n">gint_type</span><span class="p">,</span> <span class="s2">&quot;n-pages&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">images</span><span class="p">))</span>
<span class="n">animation</span><span class="o">.</span><span class="n">set_type</span><span class="p">(</span><span class="n">pyvips</span><span class="o">.</span><span class="n">GValue</span><span class="o">.</span><span class="n">gint_type</span><span class="p">,</span> <span class="s2">&quot;page-height&quot;</span><span class="p">,</span> <span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
<span class="n">animation</span><span class="o">.</span><span class="n">set_type</span><span class="p">(</span><span class="n">pyvips</span><span class="o">.</span><span class="n">GValue</span><span class="o">.</span><span class="n">array_int_type</span><span class="p">,</span> <span class="s2">&quot;delay&quot;</span><span class="p">,</span> <span class="n">delay_array</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;writing </span><span class="si">{</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> ...&quot;</span><span class="p">)</span>
<span class="n">animation</span><span class="o">.</span><span class="n">write_to_file</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</code></pre></div>

<p>It&#8217;s a little more fiddly in&nbsp;C:</p>
<div class="codehilite"><pre><span></span><code><span class="cm">/* compile with</span>
<span class="cm"> *</span>
<span class="cm"> * gcc -g -Wall assemble-animated.c `pkg-config vips --cflags --libs`</span>
<span class="cm"> */</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vips/vips.h&gt;</span>

<span class="cm">/* for libvips before 8.16, add this line:</span>
<span class="cm"> *  G_DEFINE_AUTOPTR_CLEANUP_FUNC(VipsImage, g_object_unref)</span>
<span class="cm"> */</span>

<span class="kt">int</span>
<span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">VIPS_INIT</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="w">        </span><span class="n">vips_error_exit</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
<span class="w">        </span><span class="n">vips_error_exit</span><span class="p">(</span><span class="s">&quot;usage: %s outfile infile1 infile2 ...&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

<span class="w">    </span><span class="cm">/* Load a set of input files.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="n">g_autoptr</span><span class="p">(</span><span class="n">GPtrArray</span><span class="p">)</span><span class="w"> </span><span class="n">frames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g_ptr_array_new_full</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">g_object_unref</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">argc</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">VipsImage</span><span class="w"> </span><span class="o">*</span><span class="n">frame</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">frame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vips_image_new_from_file</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
<span class="w">            </span><span class="s">&quot;access&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">VIPS_ACCESS_SEQUENTIAL</span><span class="p">,</span>
<span class="w">            </span><span class="nb">NULL</span><span class="p">)))</span>
<span class="w">            </span><span class="n">vips_error_exit</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">        </span><span class="n">g_ptr_array_add</span><span class="p">(</span><span class="n">frames</span><span class="p">,</span><span class="w"> </span><span class="n">frame</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/* Combine to form a vertical strip.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="n">g_autoptr</span><span class="p">(</span><span class="n">VipsImage</span><span class="p">)</span><span class="w"> </span><span class="n">strip</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">vips_arrayjoin</span><span class="p">((</span><span class="n">VipsImage</span><span class="w"> </span><span class="o">**</span><span class="p">)</span><span class="w"> </span><span class="n">frames</span><span class="o">-&gt;</span><span class="n">pdata</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">strip</span><span class="p">,</span><span class="w"> </span><span class="n">frames</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;across&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="nb">NULL</span><span class="p">))</span>
<span class="w">        </span><span class="n">vips_error_exit</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/* Set the animation metadata. Delay times are in milliseconds.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="n">VipsImage</span><span class="w"> </span><span class="o">*</span><span class="n">frame0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VIPS_IMAGE</span><span class="p">(</span><span class="n">frames</span><span class="o">-&gt;</span><span class="n">pdata</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="w">    </span><span class="n">vips_image_set_int</span><span class="p">(</span><span class="n">strip</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;page-height&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">frame0</span><span class="o">-&gt;</span><span class="n">Ysize</span><span class="p">);</span>
<span class="w">    </span><span class="n">vips_image_set_int</span><span class="p">(</span><span class="n">strip</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;loop&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">delays</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span><span class="w"> </span><span class="mi">300</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="n">vips_image_set_array_int</span><span class="p">(</span><span class="n">strip</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;delay&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">delays</span><span class="p">,</span><span class="w"> </span><span class="n">VIPS_NUMBER</span><span class="p">(</span><span class="n">delays</span><span class="p">));</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">vips_image_write_to_file</span><span class="p">(</span><span class="n">strip</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="nb">NULL</span><span class="p">))</span>
<span class="w">        </span><span class="n">vips_error_exit</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
    </div>
  </section>
</section>


    
<div id="toc" class="toc">
  <nav aria-labelledby="toc-title">
    <p id="toc-title">Content</p>
    <ul class="toc-list">
      
        
        <li class="toc-list-item"><a href="#reading-multipage-images"><span class="link-text">Reading multipage images</span></a></li>
          
        
        <li class="toc-list-item"><a href="#writing-multipage-images"><span class="link-text">Writing multipage images</span></a></li>
          
        
      
    </ul>
  </nav>
</div>


    <section id="search" class="content hidden"></section>

    <footer>
    
    </footer>
  </div>
</body>
</html>