<!--
SPDX-FileCopyrightText: libvips team and contributors

SPDX-License-Identifier: LGPL-2.1-or-later
-->

<!DOCTYPE html>
<html lang="en">
<head>
  <title>Vips &ndash; 8.0: Using &gt; Building image pyramids</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta charset="utf-8" />

  
  <meta property="og:type" content="website"/>

  

  
  <meta property="og:title" content="Vips: Using &gt; Building image pyramids"/>
  <meta property="og:description" content="Reference for Vips-8.0: Using &gt; Building image pyramids"/>
  <meta name="twitter:title" content="Vips: Using &gt; Building image pyramids"/>
  <meta name="twitter:description" content="Reference for Vips-8.0: Using &gt; Building image pyramids"/>


  
  <meta name="twitter:card" content="summary"/>

  
  
  
  <link rel="search" type="application/opensearchdescription+xml" title="Vips" href="opensearch.xml">
  
  

  <link rel="stylesheet" href="style.css" type="text/css" />

  

  
  <script src="urlmap.js"></script>
  
  
  <script src="fzy.js"></script>
  <script src="search.js"></script>
  
  <script src="main.js"></script>

  
</head>

<body>
  <div id="body-wrapper" tabindex="-1">

    <nav class="sidebar devhelp-hidden">
      
      
      <div class="search section">
        <form id="search-form" autocomplete="off">
          <input id="search-input" type="text" name="do-not-autocomplete" placeholder="Click, or press 's' to search" autocomplete="off"/>
        </form>
      </div>
      
      <div class="section namespace">
        <h3><a href="index.html">Vips</a></h3>
        <p>API Version: 8.0</p>
        
        <p>Library Version: 8.17</p>
        
      </div>
      
      
      <div class="section generator">
        <p>Generated by <a href="https://gitlab.gnome.org/GNOME/gi-docgen">gi-docgen</a> 2025.3</p>
      </div>
    </nav>

    <button id="btn-to-top" class="hidden"><span class="up-arrow"></span></button>

    
<section id="main" class="content">
  
  <h4 id="title" style="display:flex;">
    Using &gt; Building image pyramids
    <a href="#title" class="anchor"></a>
    
    <a class="srclink" title="go to source location" href="https://github.com/libvips/libvips/blob/master/doc/making-image-pyramids.md">[src]</a>
    
  </h4>
  
  <section>
    <div class="docblock">
    <p>libvips includes <a href="method.Image.dzsave.html"><code>vips_dzsave()</code></a>, an operation that can build image
pyramids compatible with <a href="http://en.wikipedia.org/wiki/Deep_Zoom">DeepZoom</a>,
Zoomify and <a href="https://developers.google.com/maps">Google Maps</a> image viewers.
It&#8217;s fast and can generate pyramids for large images using only a small amount
of&nbsp;memory.</p>
<p>The <span class="caps">TIFF</span> writer, <a href="method.Image.tiffsave.html"><code>vips_tiffsave()</code></a> can also build tiled pyramidal <span class="caps">TIFF</span>
images, but that&#8217;s very simple to use. This page concentrates on the DeepZoom&nbsp;builder.</p>
<p>Run dzsave with no arguments to see a&nbsp;summary:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>vips<span class="w"> </span>dzsave
save<span class="w"> </span>image<span class="w"> </span>to<span class="w"> </span>deepzoom<span class="w"> </span>file
usage:
<span class="w">   </span>dzsave<span class="w"> </span><span class="k">in</span><span class="w"> </span>filename<span class="w"> </span><span class="o">[</span>--option-name<span class="w"> </span>option-value<span class="w"> </span>...<span class="o">]</span>
where:
<span class="w">   </span><span class="k">in</span><span class="w">           </span>-<span class="w"> </span>Image<span class="w"> </span>to<span class="w"> </span>save,<span class="w"> </span>input<span class="w"> </span>VipsImage
<span class="w">   </span>filename<span class="w">     </span>-<span class="w"> </span>Filename<span class="w"> </span>to<span class="w"> </span>save<span class="w"> </span>to,<span class="w"> </span>input<span class="w"> </span>gchararray
optional<span class="w"> </span>arguments:
<span class="w">   </span>imagename<span class="w">    </span>-<span class="w"> </span>Image<span class="w"> </span>name,<span class="w"> </span>input<span class="w"> </span>gchararray
<span class="w">   </span>layout<span class="w">       </span>-<span class="w"> </span>Directory<span class="w"> </span>layout,<span class="w"> </span>input<span class="w"> </span>VipsForeignDzLayout
<span class="w">            </span>default<span class="w"> </span>enum:<span class="w"> </span>dz
<span class="w">            </span>allowed<span class="w"> </span>enums:<span class="w"> </span>dz,<span class="w"> </span>zoomify,<span class="w"> </span>google,<span class="w"> </span>iiif,<span class="w"> </span>iiif3
<span class="w">   </span>suffix<span class="w">       </span>-<span class="w"> </span>Filename<span class="w"> </span>suffix<span class="w"> </span><span class="k">for</span><span class="w"> </span>tiles,<span class="w"> </span>input<span class="w"> </span>gchararray
<span class="w">   </span>overlap<span class="w">      </span>-<span class="w"> </span>Tile<span class="w"> </span>overlap<span class="w"> </span><span class="k">in</span><span class="w"> </span>pixels,<span class="w"> </span>input<span class="w"> </span>gint
<span class="w">            </span>default:<span class="w"> </span><span class="m">1</span>
<span class="w">            </span>min:<span class="w"> </span><span class="m">0</span>,<span class="w"> </span>max:<span class="w"> </span><span class="m">8192</span>
<span class="w">   </span>tile-size<span class="w">    </span>-<span class="w"> </span>Tile<span class="w"> </span>size<span class="w"> </span><span class="k">in</span><span class="w"> </span>pixels,<span class="w"> </span>input<span class="w"> </span>gint
<span class="w">            </span>default:<span class="w"> </span><span class="m">254</span>
<span class="w">            </span>min:<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>max:<span class="w"> </span><span class="m">8192</span>
<span class="w">   </span>centre<span class="w">       </span>-<span class="w"> </span>Center<span class="w"> </span>image<span class="w"> </span><span class="k">in</span><span class="w"> </span>tile,<span class="w"> </span>input<span class="w"> </span>gboolean
<span class="w">            </span>default:<span class="w"> </span><span class="nb">false</span>
<span class="w">   </span>depth<span class="w">        </span>-<span class="w"> </span>Pyramid<span class="w"> </span>depth,<span class="w"> </span>input<span class="w"> </span>VipsForeignDzDepth
<span class="w">            </span>default<span class="w"> </span>enum:<span class="w"> </span>onepixel
<span class="w">            </span>allowed<span class="w"> </span>enums:<span class="w"> </span>onepixel,<span class="w"> </span>onetile,<span class="w"> </span>one
<span class="w">   </span>angle<span class="w">        </span>-<span class="w"> </span>Rotate<span class="w"> </span>image<span class="w"> </span>during<span class="w"> </span>save,<span class="w"> </span>input<span class="w"> </span>VipsAngle
<span class="w">            </span>default<span class="w"> </span>enum:<span class="w"> </span>d0
<span class="w">            </span>allowed<span class="w"> </span>enums:<span class="w"> </span>d0,<span class="w"> </span>d90,<span class="w"> </span>d180,<span class="w"> </span>d270
<span class="w">   </span>container<span class="w">    </span>-<span class="w"> </span>Pyramid<span class="w"> </span>container<span class="w"> </span>type,<span class="w"> </span>input<span class="w"> </span>VipsForeignDzContainer
<span class="w">            </span>default<span class="w"> </span>enum:<span class="w"> </span>fs
<span class="w">            </span>allowed<span class="w"> </span>enums:<span class="w"> </span>fs,<span class="w"> </span>zip,<span class="w"> </span>szi
<span class="w">   </span>compression<span class="w">  </span>-<span class="w"> </span>ZIP<span class="w"> </span>deflate<span class="w"> </span>compression<span class="w"> </span>level,<span class="w"> </span>input<span class="w"> </span>gint
<span class="w">            </span>default:<span class="w"> </span><span class="m">0</span>
<span class="w">            </span>min:<span class="w"> </span>-1,<span class="w"> </span>max:<span class="w"> </span><span class="m">9</span>
<span class="w">   </span>region-shrink<span class="w"> </span>-<span class="w"> </span>Method<span class="w"> </span>to<span class="w"> </span>shrink<span class="w"> </span>regions,<span class="w"> </span>input<span class="w"> </span>VipsRegionShrink
<span class="w">            </span>default<span class="w"> </span>enum:<span class="w"> </span>mean
<span class="w">            </span>allowed<span class="w"> </span>enums:<span class="w"> </span>mean,<span class="w"> </span>median,<span class="w"> </span>mode,<span class="w"> </span>max,<span class="w"> </span>min,<span class="w"> </span>nearest
<span class="w">   </span>skip-blanks<span class="w">  </span>-<span class="w"> </span>Skip<span class="w"> </span>tiles<span class="w"> </span>which<span class="w"> </span>are<span class="w"> </span>nearly<span class="w"> </span>equal<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>background,<span class="w"> </span>input<span class="w"> </span>gint
<span class="w">            </span>default:<span class="w"> </span>-1
<span class="w">            </span>min:<span class="w"> </span>-1,<span class="w"> </span>max:<span class="w"> </span><span class="m">65535</span>
<span class="w">   </span>id<span class="w">           </span>-<span class="w"> </span>Resource<span class="w"> </span>ID,<span class="w"> </span>input<span class="w"> </span>gchararray
<span class="w">   </span>Q<span class="w">            </span>-<span class="w"> </span>Q<span class="w"> </span>factor,<span class="w"> </span>input<span class="w"> </span>gint
<span class="w">            </span>default:<span class="w"> </span><span class="m">75</span>
<span class="w">            </span>min:<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>max:<span class="w"> </span><span class="m">100</span>
<span class="w">   </span>keep<span class="w">         </span>-<span class="w"> </span>Which<span class="w"> </span>metadata<span class="w"> </span>to<span class="w"> </span>retain,<span class="w"> </span>input<span class="w"> </span>VipsForeignKeep
<span class="w">            </span>default<span class="w"> </span>flags:<span class="w"> </span>exif:xmp:iptc:icc:other:all
<span class="w">            </span>allowed<span class="w"> </span>flags:<span class="w"> </span>none,<span class="w"> </span>exif,<span class="w"> </span>xmp,<span class="w"> </span>iptc,<span class="w"> </span>icc,<span class="w"> </span>other,<span class="w"> </span>all
<span class="w">   </span>background<span class="w">   </span>-<span class="w"> </span>Background<span class="w"> </span>value,<span class="w"> </span>input<span class="w"> </span>VipsArrayDouble
operation<span class="w"> </span>flags:<span class="w"> </span>sequential<span class="w"> </span>nocache
</code></pre></div>

<p>You can also call <a href="method.Image.dzsave.html"><code>vips_dzsave()</code></a> from any language with a libvips
binding, or by using <code>.dz</code> or <code>.szi</code> as an output file&nbsp;suffix.</p>
<h2 id="writing-deepzoom-pyramids">Writing DeepZoom pyramids<a class="md-anchor" href="#writing-deepzoom-pyramids" title="Permanent link"></a></h2>
<p>The <code>--layout</code> option sets the basic mode of operation. With no
<code>--layout</code>, dzsave writes DeepZoom pyramids. For&nbsp;example:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>vips<span class="w"> </span>dzsave<span class="w"> </span>huge.tif<span class="w"> </span>mydz
</code></pre></div>

<p>This will create a directory called <code>mydz_files</code> containing the image
tiles, and write a file called <code>mydz.dzi</code> containing the image&nbsp;metadata.</p>
<p>You can use the <code>--suffix</code> option to control how tiles are written. For&nbsp;example:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>vips<span class="w"> </span>dzsave<span class="w"> </span>huge.tif<span class="w"> </span>mydz<span class="w"> </span>--suffix<span class="w"> </span>.jpg<span class="o">[</span><span class="nv">Q</span><span class="o">=</span><span class="m">90</span><span class="o">]</span>
</code></pre></div>

<p>will write <span class="caps">JPEG</span> tiles with the quality factor set to 90. You can set any
format write options you like, see the <span class="caps">API</span> docs for <a href="method.Image.jpegsave.html"><code>vips_jpegsave()</code></a>
for&nbsp;details.</p>
<h2 id="writing-zoomify-pyramids">Writing Zoomify pyramids<a class="md-anchor" href="#writing-zoomify-pyramids" title="Permanent link"></a></h2>
<p>Use <code>--layout zoomify</code> to put dzsave into zoomify mode. For&nbsp;example:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>vips<span class="w"> </span>dzsave<span class="w"> </span>huge.tif<span class="w"> </span>myzoom<span class="w"> </span>--layout<span class="w"> </span>zoomify
</code></pre></div>

<p>This will create a directory called <code>myzoom</code> containing a file called
<code>ImageProperties.xml</code> with the image metadata in, and a series of
directories called <code>TileGroupn</code>, each containing 256 image&nbsp;tiles.</p>
<p>As with DeepZoom, you can use <code>--suffix</code> to set jpeg&nbsp;quality.</p>
<h2 id="writing-google-maps-pyramids">Writing Google Maps pyramids<a class="md-anchor" href="#writing-google-maps-pyramids" title="Permanent link"></a></h2>
<p>Use <code>--layout google</code> to write Google maps-style pyramids. These are
compatible with <a href="http://leafletjs.com">Leaflet</a>. For&nbsp;example:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>vips<span class="w"> </span>dzsave<span class="w"> </span>wtc.tif<span class="w"> </span>gmapdir<span class="w"> </span>--layout<span class="w"> </span>google
</code></pre></div>

<p>Will create a directory called <code>gmapdir</code> containing <code>blank.png</code>, the
file to display for blank tiles, and a set of numbered directories, one
for each zoom level. The pyramid can be sparse (blank tiles are not&nbsp;written).</p>
<p>As with DeepZoom, you can use <code>--suffix</code> to set jpeg&nbsp;quality.</p>
<p>Use <code>--background</code> to set the background colour. This is the colour
displayed for bits of the pyramid not in the image (image edges, for
example). By default, the image background is&nbsp;white.</p>
<p>Use <code>--centre</code> to add a border to the image large enough to centre the
image within the lowest resolution tile. By default, images are not&nbsp;centred.</p>
<p>For&nbsp;example:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>vips<span class="w"> </span>dzsave<span class="w"> </span>wtc.tif<span class="w"> </span>gmapdir<span class="w"> </span>--layout<span class="w"> </span>google<span class="w"> </span>--background<span class="w"> </span><span class="m">0</span><span class="w"> </span>--centre
</code></pre></div>

<h2 id="other-options">Other options<a class="md-anchor" href="#other-options" title="Permanent link"></a></h2>
<p>You can use <code>--tile-size</code> and <code>--overlap</code> to control how large the tiles
are and how they overlap (obviously). They default to the correct values
for the selected&nbsp;layout.</p>
<p>You can use <code>--depth</code> to control how deep the pyramid should be.  Possible
values are <code>onepixel</code>, <code>onetile</code> and <code>one</code>. <code>onepixel</code> means the image
is shrunk until it fits within a single pixel. <code>onetile</code> means shrink
until it fits with a tile. <code>one</code> means only write one pyramid layer (the
highest resolution one). It defaults to the correct value for the selected
layout. <code>--depth one</code> is handy for slicing up a large image into tiles
(rather than a&nbsp;pyramid).</p>
<p>You can use <code>--angle</code> to do a 90, 180 or 270 degree rotate of an image
during pyramid&nbsp;write.</p>
<p>You can use <code>--container</code> to set the container type. Normally dzsave will
write a tree of directories, but with <code>--container zip</code> you&#8217;ll get a zip file
instead. Use .zip as the directory suffix to turn on zip format&nbsp;automatically:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>vips<span class="w"> </span>dzsave<span class="w"> </span>wtc.tif<span class="w"> </span>mypyr.zip
</code></pre></div>

<p>to write a zipfile containing the tiles. You can use <code>.szi</code> as a suffix to
enable zip output as&nbsp;well.</p>
<h2 id="preprocessing-images">Preprocessing images<a class="md-anchor" href="#preprocessing-images" title="Permanent link"></a></h2>
<p>You can use <code>.dz</code> as a filename suffix, meaning send the image to
<a href="method.Image.dzsave.html"><code>vips_dzsave()</code></a>. This means you can write the output of any libvips
operation to a pyramid. For&nbsp;example:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>vips<span class="w"> </span>extract_area<span class="w"> </span>huge.svs<span class="w"> </span>mypy.dz<span class="o">[</span><span class="nv">layout</span><span class="o">=</span>google<span class="o">]</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="m">10000</span><span class="w"> </span><span class="m">10000</span>
</code></pre></div>

<p>The arguments to <code>extract_area</code> are image-in, image-out, left, top,
width, height. So this command will cut out a 10,000 by 10,000 pixel
area from near the top-left-hand corner of an Aperio slide image, then
build a pyramid in Google layout using just those&nbsp;pixels.</p>
<p>If you are working from OpenSlide images, you can use the shrink-on-load
feature of many of those formats. For&nbsp;example:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>vips<span class="w"> </span>dzsave<span class="w"> </span>CMU-1.mrxs<span class="o">[</span><span class="nv">level</span><span class="o">=</span><span class="m">1</span><span class="o">]</span><span class="w"> </span>x
</code></pre></div>

<p>Will pull out level 1 (the half-resolution level of an <span class="caps">MRXS</span> slide) and
make a pyramid from&nbsp;that.</p>
<h2 id="troubleshooting">Troubleshooting<a class="md-anchor" href="#troubleshooting" title="Permanent link"></a></h2>
<p>If you are building libvips from source you do need to check the summary at
the end of configure carefully. You must have the <code>libarchive-dev</code> package
for <a href="method.Image.dzsave.html"><code>vips_dzsave()</code></a> to&nbsp;work.</p>
    </div>
  </section>
</section>


    
<div id="toc" class="toc">
  <nav aria-labelledby="toc-title">
    <p id="toc-title">Content</p>
    <ul class="toc-list">
      
        
        <li class="toc-list-item"><a href="#writing-deepzoom-pyramids"><span class="link-text">Writing DeepZoom pyramids</span></a></li>
          
        
        <li class="toc-list-item"><a href="#writing-zoomify-pyramids"><span class="link-text">Writing Zoomify pyramids</span></a></li>
          
        
        <li class="toc-list-item"><a href="#writing-google-maps-pyramids"><span class="link-text">Writing Google Maps pyramids</span></a></li>
          
        
        <li class="toc-list-item"><a href="#other-options"><span class="link-text">Other options</span></a></li>
          
        
        <li class="toc-list-item"><a href="#preprocessing-images"><span class="link-text">Preprocessing images</span></a></li>
          
        
        <li class="toc-list-item"><a href="#troubleshooting"><span class="link-text">Troubleshooting</span></a></li>
          
        
      
    </ul>
  </nav>
</div>


    <section id="search" class="content hidden"></section>

    <footer>
    
    </footer>
  </div>
</body>
</html>