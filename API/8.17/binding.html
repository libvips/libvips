<!--
SPDX-FileCopyrightText: libvips team and contributors

SPDX-License-Identifier: LGPL-2.1-or-later
-->

<!DOCTYPE html>
<html lang="en">
<head>
  <title>Vips &ndash; 8.0: Advanced &gt; Writing bindings</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta charset="utf-8" />

  
  <meta property="og:type" content="website"/>

  

  
  <meta property="og:title" content="Vips: Advanced &gt; Writing bindings"/>
  <meta property="og:description" content="Reference for Vips-8.0: Advanced &gt; Writing bindings"/>
  <meta name="twitter:title" content="Vips: Advanced &gt; Writing bindings"/>
  <meta name="twitter:description" content="Reference for Vips-8.0: Advanced &gt; Writing bindings"/>


  
  <meta name="twitter:card" content="summary"/>

  
  
  
  <link rel="search" type="application/opensearchdescription+xml" title="Vips" href="opensearch.xml">
  
  

  <link rel="stylesheet" href="style.css" type="text/css" />

  

  
  <script src="urlmap.js"></script>
  
  
  <script src="fzy.js"></script>
  <script src="search.js"></script>
  
  <script src="main.js"></script>

  
</head>

<body>
  <div id="body-wrapper" tabindex="-1">

    <nav class="sidebar devhelp-hidden">
      
      
      <div class="search section">
        <form id="search-form" autocomplete="off">
          <input id="search-input" type="text" name="do-not-autocomplete" placeholder="Click, or press 's' to search" autocomplete="off"/>
        </form>
      </div>
      
      <div class="section namespace">
        <h3><a href="index.html">Vips</a></h3>
        <p>API Version: 8.0</p>
        
        <p>Library Version: 8.17</p>
        
      </div>
      
      
      <div class="section generator">
        <p>Generated by <a href="https://gitlab.gnome.org/GNOME/gi-docgen">gi-docgen</a> 2025.3</p>
      </div>
    </nav>

    <button id="btn-to-top" class="hidden"><span class="up-arrow"></span></button>

    
<section id="main" class="content">
  
  <h4 id="title" style="display:flex;">
    Advanced &gt; Writing bindings
    <a href="#title" class="anchor"></a>
    
    <a class="srclink" title="go to source location" href="https://github.com/libvips/libvips/blob/master/doc/binding.md">[src]</a>
    
  </h4>
  
  <section>
    <div class="docblock">
    <p>There are full libvips bindings for quite a few environments now, including
C, C++, command-line, Ruby, <span class="caps">PHP</span>, Lua, Python, Crystal, Elixir, and JavaScript&nbsp;(Node.js).</p>
<p>This chapter runs through the four main styles that have been found to work
well. If you want to write a new binding, one of these should be close
to what you&nbsp;need.</p>
<h2 id="dont-bind-the-top-level-c-api">Don't bind the top-level C API<a class="md-anchor" href="#dont-bind-the-top-level-c-api" title="Permanent link"></a></h2>
<p>The libvips C <span class="caps">API</span> (<a href="method.Image.add.html"><code>vips_add()</code></a> and so on) was designed to be easy
for humans to write. It is inconvenient and dangerous to use from other
languages due to its heavy use of&nbsp;varargs.</p>
<p>It&#8217;s much better to use the layer below. This lower layer is structured&nbsp;as:</p>
<ul>
<li>
<p>Create operator. You can use <a href="ctor.Operation.new.html"><code>vips_operation_new()</code></a> to make a new
  <a href="class.Operation.html"><code>VipsOperation</code></a> object from an operator nickname, like <code>"add"</code>.</p>
</li>
<li>
<p>Set parameters. You can use <a href="method.Object.get_args.html"><code>vips_object_get_args()</code></a> to
  get the name and type of all arguments. For each argument, you need to
  get the value from your language, convert to a <a href="javascript:void(0)" data-namespace="GObject" data-link="struct.Value.html" class="external"><code>GValue</code></a>, then
  use <a href="javascript:void(0)" data-namespace="GObject" data-link="method.Object.set_property.html" class="external"><code>g_object_set_property()</code></a> to set that value on the&nbsp;operator.</p>
</li>
<li>
<p>Execute with <a href="func.cache_operation_build.html"><code>vips_cache_operation_build()</code></a>.</p>
</li>
<li>
<p>Extract results. Again, you loop over the arguments,
  but instead of inputs, this time you look for output arguments. You
  extract their value with <a href="javascript:void(0)" data-namespace="GObject" data-link="method.Object.get_property.html" class="external"><code>g_object_get_property()</code></a>, and pass
  the value back to your&nbsp;language.</p>
</li>
</ul>
<p>For example, you can execute <a href="method.Image.invert.html"><code>vips_invert()</code></a> like&nbsp;this:</p>
<div class="codehilite"><pre><span></span><code><span class="cm">/* compile with</span>
<span class="cm"> *</span>
<span class="cm"> * gcc -g -Wall callvips.c `pkg-config vips --cflags --libs`</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vips/vips.h&gt;</span>

<span class="kt">int</span>
<span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">VipsImage</span><span class="w"> </span><span class="o">*</span><span class="n">in</span><span class="p">;</span>
<span class="w">    </span><span class="n">VipsImage</span><span class="w"> </span><span class="o">*</span><span class="n">out</span><span class="p">;</span>
<span class="w">    </span><span class="n">VipsOperation</span><span class="w"> </span><span class="o">*</span><span class="n">op</span><span class="p">;</span>
<span class="w">    </span><span class="n">VipsOperation</span><span class="w"> </span><span class="o">*</span><span class="n">new_op</span><span class="p">;</span>
<span class="w">    </span><span class="n">GValue</span><span class="w"> </span><span class="n">gvalue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">G_VALUE_INIT</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">VIPS_INIT</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="w">        </span><span class="cm">/* This shows the libvips error buffer and quits with a fail exit</span>
<span class="cm">         * code.</span>
<span class="cm">         */</span>
<span class="w">        </span><span class="n">vips_error_exit</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/* This will print a table of any ref leaks on exit, very handy for</span>
<span class="cm">     * development.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="n">vips_leak_set</span><span class="p">(</span><span class="n">TRUE</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
<span class="w">        </span><span class="n">vips_error_exit</span><span class="p">(</span><span class="s">&quot;usage: %s input-filename output-filename&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vips_image_new_from_file</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)))</span>
<span class="w">        </span><span class="n">vips_error_exit</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/* Create a new operator from a nickname. NULL for unknown operator.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="n">op</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vips_operation_new</span><span class="p">(</span><span class="s">&quot;invert&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/* Init a gvalue as an image, set it to in, use the gvalue to set the</span>
<span class="cm">     * operator property.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="n">g_value_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">gvalue</span><span class="p">,</span><span class="w"> </span><span class="n">VIPS_TYPE_IMAGE</span><span class="p">);</span>
<span class="w">    </span><span class="n">g_value_set_object</span><span class="p">(</span><span class="o">&amp;</span><span class="n">gvalue</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="p">);</span>
<span class="w">    </span><span class="n">g_object_set_property</span><span class="p">(</span><span class="n">G_OBJECT</span><span class="p">(</span><span class="n">op</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;in&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">gvalue</span><span class="p">);</span>
<span class="w">    </span><span class="n">g_value_unset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">gvalue</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/* We no longer need in: op will hold a ref to it as long as it needs</span>
<span class="cm">     * it.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="n">g_object_unref</span><span class="p">(</span><span class="n">in</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/* Call the operation. This will look up the operation+args in the libvips</span>
<span class="cm">     * operation cache and either return a previous operation, or build</span>
<span class="cm">     * this one. In either case, we have a new ref we must release.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">new_op</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vips_cache_operation_build</span><span class="p">(</span><span class="n">op</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">g_object_unref</span><span class="p">(</span><span class="n">op</span><span class="p">);</span>
<span class="w">        </span><span class="n">vips_error_exit</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">g_object_unref</span><span class="p">(</span><span class="n">op</span><span class="p">);</span>
<span class="w">    </span><span class="n">op</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new_op</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* Now get the result from op. g_value_get_object() does not ref the</span>
<span class="cm">     * object, so we need to make a ref for out to hold.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="n">g_value_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">gvalue</span><span class="p">,</span><span class="w"> </span><span class="n">VIPS_TYPE_IMAGE</span><span class="p">);</span>
<span class="w">    </span><span class="n">g_object_get_property</span><span class="p">(</span><span class="n">G_OBJECT</span><span class="p">(</span><span class="n">op</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;out&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">gvalue</span><span class="p">);</span>
<span class="w">    </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VIPS_IMAGE</span><span class="p">(</span><span class="n">g_value_get_object</span><span class="p">(</span><span class="o">&amp;</span><span class="n">gvalue</span><span class="p">));</span>
<span class="w">    </span><span class="n">g_object_ref</span><span class="p">(</span><span class="n">out</span><span class="p">);</span>
<span class="w">    </span><span class="n">g_value_unset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">gvalue</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/* All done: we can unref op. The output objects from op actually hold</span>
<span class="cm">     * refs back to it, so before we can unref op, we must unref them.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="n">vips_object_unref_outputs</span><span class="p">(</span><span class="n">VIPS_OBJECT</span><span class="p">(</span><span class="n">op</span><span class="p">));</span>
<span class="w">    </span><span class="n">g_object_unref</span><span class="p">(</span><span class="n">op</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">vips_image_write_to_file</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="nb">NULL</span><span class="p">))</span>
<span class="w">        </span><span class="n">vips_error_exit</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">    </span><span class="n">g_object_unref</span><span class="p">(</span><span class="n">out</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="compiled-language-which-can-call-c">Compiled language which can call C<a class="md-anchor" href="#compiled-language-which-can-call-c" title="Permanent link"></a></h2>
<p>The C++ binding uses this lower layer to define a function called
<code>VImage::call()</code> which can call any libvips operator with a set of variable&nbsp;arguments.</p>
<p>A small Python program walks the set of all libvips operators and generates a
set of static bindings. For&nbsp;example:</p>
<div class="codehilite"><pre><span></span><code><span class="n">VImage</span>
<span class="nf">VImage::invert</span><span class="p">(</span><span class="n">VOption</span><span class="w"> </span><span class="o">*</span><span class="n">options</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">VImage</span><span class="w"> </span><span class="n">out</span><span class="p">;</span>

<span class="w">    </span><span class="n">call</span><span class="p">(</span><span class="s">&quot;invert&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">options</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">options</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">VImage</span><span class="o">::</span><span class="n">option</span><span class="p">())</span>
<span class="w">            </span><span class="o">-&gt;</span><span class="n">set</span><span class="p">(</span><span class="s">&quot;in&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="p">)</span>
<span class="w">            </span><span class="o">-&gt;</span><span class="n">set</span><span class="p">(</span><span class="s">&quot;out&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">out</span><span class="p">));</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">out</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p>So from C++ you can call any libvips operator (though without static
typechecking) with <code>VImage::call()</code>, or use the member functions on <code>VImage</code>
to get type-checked calls for at least the required operator&nbsp;arguments.</p>
<p>The <code>VImage</code> class also adds automatic reference counting, constant expansion,
operator overloads, and various other useful&nbsp;features.</p>
<h2 id="dynamic-language-with-ffi">Dynamic language with FFI<a class="md-anchor" href="#dynamic-language-with-ffi" title="Permanent link"></a></h2>
<p>Languages like Ruby, Python, JavaScript and LuaJIT can&#8217;t call C directly, but
they do support <span class="caps">FFI</span>. The bindings for these languages work rather like C++,
but use <span class="caps">FFI</span> to call into libvips and run&nbsp;operations.</p>
<p>Since these languages are dynamic, they can add another trick: they intercept
the method-missing hook and attempt to run any method calls not implemented by
the <a href="class.Image.html"><code>VipsImage</code></a> class as libvips operators. In effect, the binding is generated
at&nbsp;runtime.</p>
<h1 id="gobject-introspection">gobject-introspection<a class="md-anchor" href="#gobject-introspection" title="Permanent link"></a></h1>
<p>The C source code to libvips has been marked up with special comments
describing the interface in a standard way. These comments are read by
the <code>gobject-introspection</code> package when libvips is compiled and used to
generate a typelib, a description of how to call the library. Many languages
have gobject-introspection packages: all you need to do to call libvips
from your favorite language is to start g-o-i, load the libvips typelib,
and you should have the whole library available. For example, from Python
it&#8217;s as simple&nbsp;as:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">gi.repository</span> <span class="kn">import</span> <span class="n">Vips</span>
</code></pre></div>

<p>You can now use all of the libvips introspection machinery, as noted&nbsp;above.</p>
<p>Unfortunately g-o-i has some strong disadvantages. It is not very portable,
since you will need a g-o-i layer for whatever platform you are targeting;
it does not cross-compile well, since typelibs include a lot of very-low
level data (such as exact structure layouts); and installation for your
users is likely to be&nbsp;tricky.</p>
<p>If you have a choice, I would recommend simply using <span class="caps">FFI</span>.</p>
<h2 id="documentation">Documentation<a class="md-anchor" href="#documentation" title="Permanent link"></a></h2>
<p>You can generate searchable docs from a <code>.gir</code> (the thing that is built
from scanning libvips and which in turn the typelib is made from) with
<code>g-ir-doc-tool</code>, for&nbsp;example:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>g-ir-doc-tool<span class="w"> </span>--language<span class="o">=</span>Python<span class="w"> </span>-o<span class="w"> </span>~/mydocs<span class="w"> </span>Vips-8.0.gir
</code></pre></div>

<p>Then to view them,&nbsp;either:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>yelp<span class="w"> </span>~/mydocs
</code></pre></div>

<p>Or&nbsp;perhaps:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>~/mydocs
$<span class="w"> </span>yelp-build<span class="w"> </span>html<span class="w"> </span>.
</code></pre></div>

<p>To make <span class="caps">HTML</span> docs. This is an easy way to see what you can call in the&nbsp;library.</p>
    </div>
  </section>
</section>


    
<div id="toc" class="toc">
  <nav aria-labelledby="toc-title">
    <p id="toc-title">Content</p>
    <ul class="toc-list">
      
        
        <li class="toc-list-item"><a href="#dont-bind-the-top-level-c-api"><span class="link-text">Don&#39;t bind the top-level C API</span></a></li>
          
        
        <li class="toc-list-item"><a href="#compiled-language-which-can-call-c"><span class="link-text">Compiled language which can call C</span></a></li>
          
        
        <li class="toc-list-item"><a href="#dynamic-language-with-ffi"><span class="link-text">Dynamic language with FFI</span></a></li>
          
        
        <li class="toc-list-item"><a href="#gobject-introspection"><span class="link-text">gobject-introspection</span></a></li>
          
          <ul class="toc-list">
          
            <li class="toc-list-item"><a href="#documentation"><span class="link-text">Documentation</span></a></li>
          
          </ul>
          
        
      
    </ul>
  </nav>
</div>


    <section id="search" class="content hidden"></section>

    <footer>
    
    </footer>
  </div>
</body>
</html>